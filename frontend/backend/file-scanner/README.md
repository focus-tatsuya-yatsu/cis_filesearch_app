# CIS File Scanner

NASãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã‚’ã‚¹ã‚­ãƒ£ãƒ³ã—ã€AWS S3ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ãŸã‚ã®ã‚¹ã‚­ãƒ£ãƒŠãƒ¼ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã€‚

## ğŸš€ æ¦‚è¦

CIS File Scannerã¯ã€ã‚ªãƒ³ãƒ—ãƒ¬ãƒŸã‚¹ã®NASã«ä¿å­˜ã•ã‚Œã¦ã„ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¹ã‚­ãƒ£ãƒ³ã—ã€ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’åé›†ã—ã¦AWS S3ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹Node.js/TypeScriptã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã™ã€‚

### ä¸»ãªæ©Ÿèƒ½

- âœ… **ãƒ—ãƒ­ãƒˆã‚³ãƒ«éä¾å­˜**: SMB/CIFSã€NFSã€ãƒã‚¦ãƒ³ãƒˆæ¸ˆã¿ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã«å¯¾å¿œ
- âœ… **å¤§è¦æ¨¡å¯¾å¿œ**: 500ä¸‡ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¹ã‚­ãƒ£ãƒ³ã«æœ€é©åŒ–
- âœ… **å·®åˆ†ã‚¹ã‚­ãƒ£ãƒ³**: å¤‰æ›´ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿ã‚’æ¤œå‡º
- âœ… **ä¸¦åˆ—å‡¦ç†**: ãƒãƒ«ãƒã‚¹ãƒ¬ãƒƒãƒ‰å‡¦ç†ã«ã‚ˆã‚‹é«˜é€Ÿã‚¹ã‚­ãƒ£ãƒ³
- âœ… **S3é€£æº**: ãƒãƒ«ãƒãƒ‘ãƒ¼ãƒˆã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å¯¾å¿œ
- âœ… **SQSé€£æº**: å‡¦ç†ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã¸ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡
- âœ… **Dockerå¯¾å¿œ**: ã‚³ãƒ³ãƒ†ãƒŠåŒ–ã«ã‚ˆã‚‹ç°¡å˜ãªãƒ‡ãƒ—ãƒ­ã‚¤
- âœ… **é€²æ—è¿½è·¡**: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€²æ—è¡¨ç¤º
- âœ… **ã‚¨ãƒ©ãƒ¼å‡¦ç†**: è‡ªå‹•ãƒªãƒˆãƒ©ã‚¤ã¨ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°

## ğŸ“‹ å¿…è¦è¦ä»¶

- Node.js 18ä»¥ä¸Š
- Dockerï¼ˆã‚³ãƒ³ãƒ†ãƒŠå®Ÿè¡Œã®å ´åˆï¼‰
- AWS ã‚¢ã‚«ã‚¦ãƒ³ãƒˆï¼ˆS3, SQSåˆ©ç”¨ï¼‰
- NASã¸ã®ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™

## ğŸ›  ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

### 1. ãƒªãƒã‚¸ãƒˆãƒªã®ã‚¯ãƒ­ãƒ¼ãƒ³

```bash
git clone [repository-url]
cd frontend/backend/file-scanner
```

### 2. ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
yarn install
```

### 3. ç’°å¢ƒå¤‰æ•°ã®è¨­å®š

```bash
cp .env.example .env
# .envãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç·¨é›†ã—ã¦AWSèªè¨¼æƒ…å ±ã¨NASè¨­å®šã‚’è¿½åŠ 
```

#### é‡è¦ãªç’°å¢ƒå¤‰æ•°

```env
# AWSè¨­å®š
AWS_REGION=ap-northeast-1
AWS_ACCESS_KEY_ID=your_access_key
AWS_SECRET_ACCESS_KEY=your_secret_key

# S3è¨­å®š
S3_BUCKET_NAME=cis-filesearch-landing-dev

# SQSè¨­å®š
SQS_QUEUE_URL=https://sqs.ap-northeast-1.amazonaws.com/xxx/cis-filesearch-queue

# NASè¨­å®š
NAS_MOUNT_PATH=/mnt/nas
NAS_PROTOCOL=auto  # auto|smb|nfs|mounted

# ã‚¹ã‚­ãƒ£ãƒ³è¨­å®š
SCAN_BATCH_SIZE=1000
SCAN_PARALLELISM=20
SCAN_MAX_FILE_SIZE_MB=5000
```

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### ãƒ­ãƒ¼ã‚«ãƒ«å®Ÿè¡Œ

#### TypeScriptã§ç›´æ¥å®Ÿè¡Œï¼ˆé–‹ç™ºç”¨ï¼‰

```bash
# ãƒ•ãƒ«ã‚¹ã‚­ãƒ£ãƒ³
yarn dev scan

# å·®åˆ†ã‚¹ã‚­ãƒ£ãƒ³
yarn dev diff

# çµ±è¨ˆè¡¨ç¤º
yarn dev stats

# ãƒ‰ãƒ©ã‚¤ãƒ©ãƒ³ï¼ˆå®Ÿéš›ã«ã¯ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ãªã„ï¼‰
DRY_RUN=true yarn dev scan
```

#### ãƒ“ãƒ«ãƒ‰ã—ã¦å®Ÿè¡Œ

```bash
# ãƒ“ãƒ«ãƒ‰
yarn build

# å®Ÿè¡Œ
node dist/index.js scan
```

### Dockerå®Ÿè¡Œ

#### Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ã®ãƒ“ãƒ«ãƒ‰

```bash
./scripts/docker-build.sh
```

#### Dockerã§ã‚¹ã‚­ãƒ£ãƒ³å®Ÿè¡Œ

```bash
# ãƒ•ãƒ«ã‚¹ã‚­ãƒ£ãƒ³
docker run --rm \
  --env-file .env \
  -v /path/to/nas:/mnt/nas:ro \
  cis-file-scanner:latest scan

# ãƒ‰ãƒ©ã‚¤ãƒ©ãƒ³ãƒ¢ãƒ¼ãƒ‰
docker run --rm \
  --env-file .env \
  -e DRY_RUN=true \
  -v /path/to/nas:/mnt/nas:ro \
  cis-file-scanner:latest scan --dry-run
```

#### Docker Composeã§å®Ÿè¡Œ

```bash
# é–‹ç™ºç’°å¢ƒï¼ˆLocalStackä»˜ãï¼‰
docker-compose --profile development up

# ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«å®Ÿè¡Œï¼ˆ6æ™‚é–“ã”ã¨ï¼‰
docker-compose --profile scheduled up -d
```

## ğŸ“¦ ã‚¹ã‚­ãƒ£ãƒŠãƒ¼PCã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤

### ğŸ–¥ï¸ Windows 11 Proç’°å¢ƒã®å ´åˆ

Windows 11 Proã‚¹ã‚­ãƒ£ãƒŠãƒ¼ PCã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã«ã¤ã„ã¦ã¯ã€å°‚ç”¨ã‚¬ã‚¤ãƒ‰ã‚’å‚ç…§ã—ã¦ãã ã•ã„ï¼š

- **å®Œå…¨ç‰ˆã‚¬ã‚¤ãƒ‰**: [`/docs/deployment/windows-scanner-pc-setup-guide.md`](/docs/deployment/windows-scanner-pc-setup-guide.md)
- **ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ**: [`/docs/deployment/scanner-pc-quickstart.md`](/docs/deployment/scanner-pc-quickstart.md)
- **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ**: [`/docs/deployment/scanner-pc-security-checklist.md`](/docs/deployment/scanner-pc-security-checklist.md)
- **æ¤œè¨¼ã‚¹ã‚¯ãƒªãƒ—ãƒˆ**: [`verify-setup.ps1`](./verify-setup.ps1)

**Windowsç’°å¢ƒã§ã®å®Ÿè¡Œä¾‹**:
```powershell
# PowerShellã¾ãŸã¯Git Bash

# ä¾å­˜é–¢ä¿‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
yarn install

# ãƒ“ãƒ«ãƒ‰
yarn build

# ãƒ‰ãƒ©ã‚¤ãƒ©ãƒ³
DRY_RUN=true node dist/index.js scan

# æœ¬ç•ªå®Ÿè¡Œ
node dist/index.js scan
```

---

### ğŸ§ Linux/Macç’°å¢ƒã®å ´åˆ

### 1. Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ã®è»¢é€

```bash
# ãƒ‡ãƒ—ãƒ­ã‚¤ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½¿ç”¨
./scripts/deploy-to-scanner.sh 192.168.1.100 scanner

# ã¾ãŸã¯æ‰‹å‹•ã§
docker save cis-file-scanner:latest -o cis-scanner.tar
scp cis-scanner.tar scanner@scanner-pc:/tmp/
ssh scanner@scanner-pc
docker load -i /tmp/cis-scanner.tar
```

### 2. ã‚¹ã‚­ãƒ£ãƒŠãƒ¼PCã§ã®å®Ÿè¡Œ

```bash
# ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®š
vi .env

# ãƒ•ãƒ«ã‚¹ã‚­ãƒ£ãƒ³å®Ÿè¡Œ
./scripts/run-scanner.sh scan

# ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«å®Ÿè¡Œé–‹å§‹
./scripts/run-scanner.sh schedule
```

## ğŸ“Š ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æŒ‡æ¨™

### å‡¦ç†é€Ÿåº¦ï¼ˆç›®å®‰ï¼‰

| ãƒ•ã‚¡ã‚¤ãƒ«æ•° | ã‚¹ã‚­ãƒ£ãƒ³æ™‚é–“ | ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ™‚é–“ï¼ˆ100Mbpsï¼‰ | åˆè¨ˆæ™‚é–“ |
|-----------|------------|--------------------------|---------|
| 100ä¸‡ | 1-2æ™‚é–“ | 12æ™‚é–“ | 14æ™‚é–“ |
| 500ä¸‡ | 5-10æ™‚é–“ | 2.4æ—¥ | 3æ—¥ |

### ãƒªã‚½ãƒ¼ã‚¹ä½¿ç”¨é‡

- **CPU**: 2ã‚³ã‚¢æ¨å¥¨ï¼ˆä¸¦åˆ—å‡¦ç†ç”¨ï¼‰
- **ãƒ¡ãƒ¢ãƒª**: 2-4GBï¼ˆãƒãƒƒãƒ•ã‚¡ã‚µã‚¤ã‚ºã«ã‚ˆã‚‹ï¼‰
- **ãƒ‡ã‚£ã‚¹ã‚¯**: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç”¨ã«1GBä»¥ä¸Š

## ğŸ” ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### NASã«æ¥ç¶šã§ããªã„

```bash
# ãƒã‚¦ãƒ³ãƒˆçŠ¶æ…‹ã‚’ç¢ºèª
mount | grep nas

# æ‰‹å‹•ãƒã‚¦ãƒ³ãƒˆï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰
sudo mount -t nfs 192.168.1.100:/volume1 /mnt/nas
```

### S3ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãŒé…ã„

```env
# ä¸¦è¡Œã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ•°ã‚’å¢—ã‚„ã™
S3_UPLOAD_CONCURRENCY=20

# ãƒãƒ£ãƒ³ã‚¯ã‚µã‚¤ã‚ºã‚’èª¿æ•´
S3_MULTIPART_CHUNK_SIZE_MB=20
```

### ãƒ¡ãƒ¢ãƒªä¸è¶³ã‚¨ãƒ©ãƒ¼

```bash
# Node.jsã®ãƒ¡ãƒ¢ãƒªåˆ¶é™ã‚’å¢—ã‚„ã™
NODE_OPTIONS="--max-old-space-size=4096" yarn dev scan
```

## ğŸ“ ã‚³ãƒãƒ³ãƒ‰ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹

| ã‚³ãƒãƒ³ãƒ‰ | èª¬æ˜ | ä¾‹ |
|---------|------|-----|
| `scan` | ãƒ•ãƒ«ã‚¹ã‚­ãƒ£ãƒ³ã‚’å®Ÿè¡Œ | `yarn dev scan` |
| `diff` | å·®åˆ†ã‚¹ã‚­ãƒ£ãƒ³ã‚’å®Ÿè¡Œ | `yarn dev diff` |
| `schedule <cron>` | ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«å®Ÿè¡Œ | `yarn dev schedule "0 */6 * * *"` |
| `stats` | çµ±è¨ˆæƒ…å ±ã‚’è¡¨ç¤º | `yarn dev stats` |

### ã‚ªãƒ—ã‚·ãƒ§ãƒ³

- `--dry-run` / `-d`: ãƒ‰ãƒ©ã‚¤ãƒ©ãƒ³ãƒ¢ãƒ¼ãƒ‰ï¼ˆå®Ÿéš›ã«ã¯ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ãªã„ï¼‰
- `--skip-sqs`: SQSã¸ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡ã‚’ã‚¹ã‚­ãƒƒãƒ—

## ğŸ— ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     NAS     â”‚â”€â”€â”€â”€â–¶â”‚ File Scanner â”‚â”€â”€â”€â”€â–¶â”‚   S3    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚                   â”‚
                            â–¼                   â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   SQLite DB  â”‚     â”‚   SQS   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

1. **FileSystemAdapter**: NASã‚¢ã‚¯ã‚»ã‚¹æŠ½è±¡åŒ–ãƒ¬ã‚¤ãƒ¤ãƒ¼
2. **FileScanner**: ãƒ•ã‚¡ã‚¤ãƒ«ã‚¹ã‚­ãƒ£ãƒ³ã‚³ã‚¢ãƒ­ã‚¸ãƒƒã‚¯
3. **DatabaseManager**: SQLiteã«ã‚ˆã‚‹ãƒ­ãƒ¼ã‚«ãƒ«çŠ¶æ…‹ç®¡ç†
4. **S3Uploader**: S3ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å‡¦ç†
5. **SQSPublisher**: SQSãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡
6. **ProgressTracker**: é€²æ—è¿½è·¡

## ğŸ§ª ãƒ†ã‚¹ãƒˆ

```bash
# ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
yarn test

# ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
yarn test:coverage
```

## ğŸ“„ ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

MIT

## ğŸ‘¥ ã‚³ãƒ³ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³

ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’æ­“è¿ã—ã¾ã™ã€‚å¤§ããªå¤‰æ›´ã®å ´åˆã¯ã€ã¾ãšissueã‚’é–‹ã„ã¦å¤‰æ›´å†…å®¹ã«ã¤ã„ã¦è­°è«–ã—ã¦ãã ã•ã„ã€‚

## ğŸ“ ã‚µãƒãƒ¼ãƒˆ

å•é¡ŒãŒç™ºç”Ÿã—ãŸå ´åˆã¯ã€GitHubã®issueã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚
# ğŸ¯ ç”»åƒã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹åŒ– - æœ€çµ‚å®Ÿè¡Œæ‰‹é †

## ç¾åœ¨ã®çŠ¶æ³
- âœ… OpenSearchã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ï¼ˆfile-index-v2-knnï¼‰ãŒå­˜åœ¨
- âœ… 10ä»¶ã®ã‚µãƒ³ãƒ—ãƒ«ç”»åƒãŒã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹æ¸ˆã¿
- âœ… å®Ÿç”»åƒã®ãƒ™ã‚¯ãƒˆãƒ«åŒ–ãŒå¯èƒ½ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«APIçµŒç”±ï¼‰
- âŒ VPCã®ãŸã‚ãƒ­ãƒ¼ã‚«ãƒ«ã‹ã‚‰ç›´æ¥OpenSearchã«ã‚¢ã‚¯ã‚»ã‚¹ä¸å¯

## æ¨å¥¨ã•ã‚Œã‚‹å®Ÿè¡Œæ–¹æ³•

### æ–¹æ³•A: EC2ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹çµŒç”±ï¼ˆæœ€ã‚‚ç¢ºå®Ÿï¼‰

1. **EC2ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ç¢ºèª**
```bash
aws ec2 describe-instances \
  --filters "Name=instance-state-name,Values=running" \
  --query "Reservations[].Instances[].[InstanceId,Tags[?Key=='Name'].Value|[0]]" \
  --output table
```

2. **SSMã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã§æ¥ç¶š**
```bash
aws ssm start-session --target [ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ID]
```

3. **EC2ä¸Šã§Pythonã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œ**
```bash
# ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ã‚³ãƒ”ãƒ¼
cat > /tmp/index_images.py << 'EOF'
[remote-index-images.shã®å†…å®¹ã‚’ãƒšãƒ¼ã‚¹ãƒˆ]
EOF

# å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
pip3 install opensearch-py requests-aws4auth boto3

# å®Ÿè¡Œ
python3 /tmp/index_images.py
```

### æ–¹æ³•B: Lambdaé–¢æ•°ã‚’ä¿®æ­£ï¼ˆç®¡ç†è€…å‘ã‘ï¼‰

1. **æ—¢å­˜ã®Lambdaé–¢æ•°ï¼ˆcis-search-api-prodï¼‰ã«ç®¡ç†æ©Ÿèƒ½ã‚’è¿½åŠ **
   - `/admin/delete-samples` ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆè¿½åŠ 
   - `/admin/index-image` ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆè¿½åŠ 

2. **API GatewayçµŒç”±ã§å®Ÿè¡Œ**
```bash
# ã‚µãƒ³ãƒ—ãƒ«å‰Šé™¤
curl -X POST https://5xbn3ng31f.execute-api.ap-northeast-1.amazonaws.com/default/admin/delete-samples

# ç”»åƒã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
curl -X POST https://5xbn3ng31f.execute-api.ap-northeast-1.amazonaws.com/default/admin/index-image \
  -d '{"s3_key": "documents/road/..."}'
```

### æ–¹æ³•C: æ—¢å­˜ã‚·ã‚¹ãƒ†ãƒ ã‚’æ´»ç”¨ï¼ˆå¿œæ€¥å‡¦ç½®ï¼‰

ç¾åœ¨ã®ã‚·ã‚¹ãƒ†ãƒ ã§ã‚‚ç”»åƒæ¤œç´¢ã¯å‹•ä½œã—ã¾ã™ãŒã€ã‚µãƒ³ãƒ—ãƒ«ç”»åƒã—ã‹è¿”ã—ã¾ã›ã‚“ã€‚
å®Ÿç”»åƒã‚’æ¤œç´¢å¯èƒ½ã«ã™ã‚‹ã«ã¯ã€ä¸Šè¨˜ã®A ã¾ãŸã¯Bã®æ–¹æ³•ã§ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹åŒ–ãŒå¿…è¦ã§ã™ã€‚

## ã‚¯ã‚¤ãƒƒã‚¯ç¢ºèªã‚³ãƒãƒ³ãƒ‰

### ç¾åœ¨ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹çŠ¶æ…‹ã‚’ç¢ºèª
```bash
# 1024æ¬¡å…ƒã®ãƒ€ãƒŸãƒ¼ãƒ™ã‚¯ãƒˆãƒ«ã§æ¤œç´¢ãƒ†ã‚¹ãƒˆ
./test-image-1024.sh
```

### å®Ÿç”»åƒã®ãƒ™ã‚¯ãƒˆãƒ«ç”Ÿæˆãƒ†ã‚¹ãƒˆ
```bash
python3 scripts/index-real-images-simple.py
```

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### å•é¡Œ1: VPCã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã«æ¥ç¶šã§ããªã„
**åŸå› **: OpenSearchãŒVPCå†…ã«ã‚ã‚‹ãŸã‚
**è§£æ±º**: EC2ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹çµŒç”±ã§å®Ÿè¡Œ

### å•é¡Œ2: AWSèªè¨¼ã‚¨ãƒ©ãƒ¼
**è§£æ±º**:
```bash
aws sso login
aws sts get-caller-identity
```

### å•é¡Œ3: Bedrockã‚¨ãƒ©ãƒ¼
**åŸå› **: us-east-1ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã§ã®ã¿åˆ©ç”¨å¯èƒ½
**è§£æ±º**: ç’°å¢ƒå¤‰æ•°ã§è¨­å®š
```bash
export BEDROCK_REGION=us-east-1
```

## ğŸ“Š å‡¦ç†æ™‚é–“ã®ç›®å®‰

| ç”»åƒæ•° | å‡¦ç†æ™‚é–“ | å‚™è€ƒ |
|--------|----------|------|
| 10ä»¶ | ç´„5åˆ† | ãƒ†ã‚¹ãƒˆç”¨ |
| 100ä»¶ | ç´„30åˆ† | å°è¦æ¨¡ |
| 1,000ä»¶ | ç´„3æ™‚é–“ | ä¸­è¦æ¨¡ |
| 10,000ä»¶ | ç´„24æ™‚é–“ | å¤§è¦æ¨¡ |

## ğŸš€ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

1. **ãƒ†ã‚¹ãƒˆç’°å¢ƒã§10ä»¶ã‚’ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹åŒ–**
   - ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤
   - å®Ÿç”»åƒ10ä»¶ã‚’ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
   - å‹•ä½œç¢ºèª

2. **æœ¬ç•ªç’°å¢ƒã¸ã®å±•é–‹**
   - ãƒãƒƒãƒå‡¦ç†ã®è¨­å®š
   - ç›£è¦–ãƒ»ãƒ­ã‚°ã®è¨­å®š
   - å®šæœŸçš„ãªæ›´æ–°å‡¦ç†ã®è‡ªå‹•åŒ–

3. **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–**
   - ä¸¦åˆ—å‡¦ç†ã®å®Ÿè£…
   - ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®æ´»ç”¨
   - ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®æœ€é©åŒ–

---

ä½œæˆæ—¥: 2024-12-19
ä½œæˆè€…: Claude Code Assistant
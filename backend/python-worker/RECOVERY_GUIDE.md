# DLQ Recovery Monitoring & Optimization Guide

## æ¦‚è¦

ã“ã®ã‚¬ã‚¤ãƒ‰ã§ã¯ã€DLQãƒªã‚«ãƒãƒªãƒ¼ã®ç›£è¦–ã€æœ€é©åŒ–ã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åˆ†æã®ãŸã‚ã®å®Œå…¨ãªãƒ„ãƒ¼ãƒ«ã‚»ãƒƒãƒˆã‚’æä¾›ã—ã¾ã™ã€‚

## æº–å‚™: EC2ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤

### 1. ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’EC2ã«ã‚³ãƒ”ãƒ¼

```bash
# ãƒ­ãƒ¼ã‚«ãƒ«ã‹ã‚‰EC2ã¸ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ã‚³ãƒ”ãƒ¼
scp -i ~/.ssh/your-key.pem \
    monitor_recovery.sh \
    check_opensearch.sh \
    optimize_recovery.sh \
    performance_report.sh \
    ec2-user@<EC2-IP>:/home/ec2-user/
```

### 2. EC2ã§å®Ÿè¡Œæ¨©é™ã‚’ä»˜ä¸

```bash
# EC2ã«SSHæ¥ç¶š
ssh -i ~/.ssh/your-key.pem ec2-user@<EC2-IP>

# å®Ÿè¡Œæ¨©é™ã‚’ä»˜ä¸
chmod +x monitor_recovery.sh
chmod +x check_opensearch.sh
chmod +x optimize_recovery.sh
chmod +x performance_report.sh
```

## ãƒ„ãƒ¼ãƒ«ä¸€è¦§

### 1. ãƒªã‚«ãƒãƒªãƒ¼é€²æ—ç›£è¦– (`monitor_recovery.sh`)

**ç›®çš„**: DLQãƒªã‚«ãƒãƒªãƒ¼ã®é€²æ—ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ç›£è¦–

**ä½¿ç”¨æ–¹æ³•**:
```bash
./monitor_recovery.sh
```

**è¡¨ç¤ºå†…å®¹**:
- DLQãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ•°ï¼ˆAvailable / In-Flightï¼‰
- ãƒ¡ã‚¤ãƒ³ã‚­ãƒ¥ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ•°ï¼ˆAvailable / In-Flightï¼‰
- å‡¦ç†æ¸ˆã¿ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ•°ã¨é€²æ—ç‡
- å‡¦ç†é€Ÿåº¦ï¼ˆmsg/secï¼‰
- çµŒéæ™‚é–“ã¨å®Œäº†äºˆæƒ³æ™‚é–“ï¼ˆETAï¼‰
- ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼

**æ›´æ–°é–“éš”**: 30ç§’ï¼ˆã‚¹ã‚¯ãƒªãƒ—ãƒˆå†…ã§å¤‰æ›´å¯èƒ½ï¼‰

**åœæ­¢æ–¹æ³•**: `Ctrl+C`

**ã‚µãƒ³ãƒ—ãƒ«å‡ºåŠ›**:
```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘         DLQ Recovery Progress Monitor                          â•‘
â•‘         Started at: 2025-12-15 10:30:00                        â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Initial DLQ messages: 8163

[10:30:30] â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
DLQ Status:
  Available: 7950
  In Flight: 0

Main Queue Status:
  Available: 150
  In Flight: 10

Recovery Progress:
  Processed: 213 / 8163
  Progress: 2.61%
  Rate: 10.65 msg/sec
  Elapsed: 00:00:20
  ETA: 12h 15m

  [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 2.61%
```

---

### 2. OpenSearch ãƒ‡ãƒ¼ã‚¿æ¤œè¨¼ (`check_opensearch.sh`)

**ç›®çš„**: OpenSearchã«ãƒ‡ãƒ¼ã‚¿ãŒæ­£ã—ãæ ¼ç´ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª

**ä½¿ç”¨æ–¹æ³•**:
```bash
./check_opensearch.sh
```

**æ¤œè¨¼é …ç›®**:
1. ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ãƒ˜ãƒ«ã‚¹
2. ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹çµ±è¨ˆï¼ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ•°ã€ã‚µã‚¤ã‚ºï¼‰
3. æœ€è¿‘ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆï¼ˆæœ€æ–°5ä»¶ï¼‰
4. ãƒ•ã‚¡ã‚¤ãƒ«ã‚¿ã‚¤ãƒ—åˆ¥åˆ†å¸ƒ
5. æœ€è¿‘1æ™‚é–“ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹é€Ÿåº¦
6. ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãƒ˜ãƒ«ã‚¹
7. ã‚µãƒ³ãƒ—ãƒ«æ¤œç´¢ãƒ†ã‚¹ãƒˆ

**ã‚µãƒ³ãƒ—ãƒ«å‡ºåŠ›**:
```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘         OpenSearch Data Verification                           â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. Cluster Health
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
{
  "status": "green",
  "number_of_nodes": 2,
  "active_shards": 10
}

2. Index Statistics
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  Total Documents: 5,432
  Index Size: 156.78 MB

3. Recent Documents (Last 5)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
{
  "path": "/mnt/nas/documents/report.pdf",
  "name": "report.pdf",
  "size": 1024567,
  "modified": "2025-12-15T10:25:30Z"
}
...

4. File Type Distribution
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
{
  "extension": "pdf",
  "count": 2341
}
{
  "extension": "docx",
  "count": 1542
}
...

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                     Summary                                    â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  âœ“ Total Documents: 5,432
  âœ“ Index Size: 156.78 MB
  âœ“ Recent Indexing Rate: 8.52 docs/sec
  âœ“ Search Performance: 45 ms

âœ“ OpenSearch is receiving data successfully
```

---

### 3. ãƒªã‚«ãƒãƒªãƒ¼æœ€é©åŒ– (`optimize_recovery.sh`)

**ç›®çš„**: DLQãƒªã‚«ãƒãƒªãƒ¼ã®å‡¦ç†é€Ÿåº¦ã‚’åŠ‡çš„ã«å‘ä¸Š

**æ”¹å–„å†…å®¹**:
- ãƒãƒƒãƒã‚µã‚¤ã‚º: 10 â†’ **100** (10å€)
- ä¸¦åˆ—å‡¦ç†: **5ã‚¹ãƒ¬ãƒƒãƒ‰**
- å¾…æ©Ÿæ™‚é–“ã®æœ€é©åŒ–

**ä½¿ç”¨æ–¹æ³•**:
```bash
./optimize_recovery.sh
```

**æœŸå¾…ã•ã‚Œã‚‹åŠ¹æœ**:
- å‡¦ç†é€Ÿåº¦: ~10 msg/sec â†’ **~50-100 msg/sec** (5-10å€é«˜é€ŸåŒ–)
- å®Œäº†äºˆæƒ³æ™‚é–“: 12æ™‚é–“ â†’ **1-2æ™‚é–“**

**æ³¨æ„äº‹é …**:
- æ—¢å­˜ã®ãƒªã‚«ãƒãƒªãƒ¼ãƒ—ãƒ­ã‚»ã‚¹ãŒå®Ÿè¡Œä¸­ã®å ´åˆã€ç¢ºèªå¾Œã«å†èµ·å‹•ã—ã¾ã™
- OpenSearchã¨SQSã«é«˜è² è·ãŒã‹ã‹ã‚‹ãŸã‚ã€æœ¬ç•ªç’°å¢ƒã§ã¯æ³¨æ„ãŒå¿…è¦ã§ã™
- ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ãŒå¢—åŠ ã—ã¾ã™ï¼ˆæœ€å¤§500MBç¨‹åº¦ï¼‰

**ã‚µãƒ³ãƒ—ãƒ«å‡ºåŠ›**:
```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘         DLQ Recovery Optimization                              â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Checking current recovery process...
âœ“ Recovery process is running:
ec2-user  12345  python3 recover_dlq_messages.py

Do you want to restart with optimized settings? (y/n)
y

Stopping current process...
âœ“ Optimized recovery script created

Starting optimized recovery...
Note: This will run in the foreground. Press Ctrl+C to stop.

ğŸš€ Starting optimized DLQ recovery at 10:35:00
ğŸ“Š Configuration: Batch size=100, Workers=5

ğŸ“ Initial DLQ messages: 7,850

ğŸ“¦ Batch 1: Processed 100 messages
   Total: 100/7,850 (1.3%)
   Rate: 50.25 msg/sec
   Remaining: 7,750
   ETA: ~2 minutes

ğŸ“¦ Batch 2: Processed 100 messages
   Total: 200/7,850 (2.5%)
   Rate: 52.18 msg/sec
   Remaining: 7,650
   ETA: ~2 minutes
...
```

---

### 4. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ¬ãƒãƒ¼ãƒˆ (`performance_report.sh`)

**ç›®çš„**: ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã®åŒ…æ‹¬çš„ãªãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åˆ†æ

**ä½¿ç”¨æ–¹æ³•**:
```bash
# æ¨™æº–å‡ºåŠ›ã«è¡¨ç¤º
./performance_report.sh

# ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜
./performance_report.sh report.txt

# ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç›£è¦–ï¼ˆ30ç§’ã”ã¨ã«æ›´æ–°ï¼‰
watch -n 30 './performance_report.sh /dev/stdout'
```

**ãƒ¬ãƒãƒ¼ãƒˆå†…å®¹**:
1. ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦
2. SQSã‚­ãƒ¥ãƒ¼çµ±è¨ˆï¼ˆDLQã€ãƒ¡ã‚¤ãƒ³ã‚­ãƒ¥ãƒ¼ï¼‰
3. OpenSearchçµ±è¨ˆï¼ˆã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ãƒ˜ãƒ«ã‚¹ã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ•°ï¼‰
4. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ¡ãƒˆãƒªã‚¯ã‚¹ï¼ˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹é€Ÿåº¦ã€æ¤œç´¢é€Ÿåº¦ï¼‰
5. ã‚­ãƒ¥ãƒ¼å‡¦ç†é€Ÿåº¦ã®æ¨å®š
6. æœ€é©åŒ–ã®æ¨å¥¨äº‹é …
7. ã‚·ã‚¹ãƒ†ãƒ ãƒ˜ãƒ«ã‚¹ã‚µãƒãƒªãƒ¼ï¼ˆãƒ˜ãƒ«ã‚¹ã‚¹ã‚³ã‚¢ï¼‰
8. æ¨å¥¨ã•ã‚Œã‚‹æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

**ã‚µãƒ³ãƒ—ãƒ«å‡ºåŠ›**:
```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           PERFORMANCE ANALYSIS REPORT
           Generated: 2025-12-15 10:40:00 JST
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. SYSTEM OVERVIEW
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Region: ap-northeast-1
Timestamp: 2025-12-15T01:40:00Z

2. SQS QUEUE STATISTICS
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Dead Letter Queue (DLQ):
  Available Messages: 7650
  In-Flight Messages: 0
  Delayed Messages: 0

Main Queue:
  Available Messages: 120
  In-Flight Messages: 15
  Delayed Messages: 0

3. OPENSEARCH STATISTICS
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Cluster Health:
  Status: green
  Number of Nodes: 2

Index Statistics:
  Total Documents: 5,678
  Index Size: 165.34 MB

4. PERFORMANCE METRICS
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Indexing Performance:
  Documents indexed (last hour): 456
  Average indexing rate: 8.52 docs/sec

Search Performance:
  Average search time: 45 ms

5. QUEUE PROCESSING ESTIMATES
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
DLQ Recovery Estimate:
  Remaining messages: 7650
  Current processing rate: 10.5 msg/sec
  Estimated time to completion: 12h 8m

6. OPTIMIZATION RECOMMENDATIONS
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âš ï¸  HIGH: Large DLQ backlog detected
   Recommendation: Consider running optimized recovery script
   Command: ./optimize_recovery.sh

7. HEALTH SUMMARY
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Overall Health Score: 80/100
Status: âš ï¸  Issues detected:
  - Large DLQ backlog

8. RECOMMENDED NEXT STEPS
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
1. Monitor DLQ recovery progress:
   ./monitor_recovery.sh

2. Consider optimizing recovery:
   ./optimize_recovery.sh

3. Verify OpenSearch data integrity:
   ./check_opensearch.sh

4. Continue monitoring with real-time dashboard:
   watch -n 30 './performance_report.sh /dev/stdout'

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           END OF REPORT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## æ¨å¥¨ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

### åˆæœŸã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ™‚

```bash
# 1. ç¾åœ¨ã®çŠ¶æ³ã‚’æŠŠæ¡
./performance_report.sh initial_report.txt

# 2. OpenSearchã®çŠ¶æ…‹ã‚’ç¢ºèª
./check_opensearch.sh

# 3. ãƒªã‚«ãƒãƒªãƒ¼ã®æœ€é©åŒ–ã‚’æ¤œè¨
./optimize_recovery.sh
```

### æ—¥å¸¸çš„ãªç›£è¦–

```bash
# æ–¹æ³•A: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç›£è¦–ï¼ˆåˆ¥ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§å®Ÿè¡Œï¼‰
./monitor_recovery.sh

# æ–¹æ³•B: å®šæœŸçš„ãªãƒ¬ãƒãƒ¼ãƒˆï¼ˆãƒ¡ã‚¤ãƒ³ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§å®Ÿè¡Œï¼‰
watch -n 30 './performance_report.sh /dev/stdout'
```

### ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

```bash
# 1. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ¬ãƒãƒ¼ãƒˆã§å•é¡Œã‚’ç‰¹å®š
./performance_report.sh problem_report.txt

# 2. OpenSearchã®è©³ç´°ã‚’ç¢ºèª
./check_opensearch.sh

# 3. å¿…è¦ã«å¿œã˜ã¦æœ€é©åŒ–ã‚’å®Ÿè¡Œ
./optimize_recovery.sh
```

---

## å®Œäº†äºˆæƒ³æ™‚é–“ã®è¨ˆç®—

### ç¾åœ¨ã®è¨­å®šï¼ˆæ¨™æº–ãƒªã‚«ãƒãƒªãƒ¼ï¼‰
- **ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ•°**: 8,163
- **å‡¦ç†é€Ÿåº¦**: ~10 msg/sec
- **äºˆæƒ³æ™‚é–“**: ~13.6åˆ† = **ç´„14åˆ†**

### æœ€é©åŒ–å¾Œï¼ˆoptimize_recovery.shä½¿ç”¨ï¼‰
- **ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ•°**: 8,163
- **å‡¦ç†é€Ÿåº¦**: ~50-100 msg/secï¼ˆ5-10å€é«˜é€ŸåŒ–ï¼‰
- **äºˆæƒ³æ™‚é–“**: ~1.6-2.7åˆ† = **ç´„2-3åˆ†**

### å®Ÿéš›ã®å®Œäº†æ™‚é–“ã«å½±éŸ¿ã™ã‚‹è¦å› 

1. **OpenSearchã®å¿œç­”é€Ÿåº¦**
   - ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã®è² è·çŠ¶æ³
   - ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚µã‚¤ã‚º
   - ã‚·ãƒ£ãƒ¼ãƒ‰æ•°

2. **ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å¸¯åŸŸå¹…**
   - EC2 â†” SQS
   - EC2 â†” OpenSearch

3. **EC2ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ã‚¹ãƒšãƒƒã‚¯**
   - CPUä½¿ç”¨ç‡
   - ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡
   - ãƒ‡ã‚£ã‚¹ã‚¯I/O

4. **ä¸¦è¡Œå‡¦ç†æ•°**
   - æ¨™æº–: 1ã‚¹ãƒ¬ãƒƒãƒ‰
   - æœ€é©åŒ–: 5ã‚¹ãƒ¬ãƒƒãƒ‰

---

## ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æŒ‡æ¨™ã®ç›®å®‰

### æ­£å¸¸ãªçŠ¶æ…‹
- âœ… DLQ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸: **0**
- âœ… ãƒ¡ã‚¤ãƒ³ã‚­ãƒ¥ãƒ¼å¾…æ©Ÿ: **< 100**
- âœ… ãƒ¡ã‚¤ãƒ³ã‚­ãƒ¥ãƒ¼å‡¦ç†ä¸­: **> 0**
- âœ… ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹é€Ÿåº¦: **> 5 docs/sec**
- âœ… æ¤œç´¢é€Ÿåº¦: **< 500 ms**
- âœ… ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: **green**

### æ³¨æ„ãŒå¿…è¦ãªçŠ¶æ…‹
- âš ï¸ DLQ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸: **100-1000**
- âš ï¸ ãƒ¡ã‚¤ãƒ³ã‚­ãƒ¥ãƒ¼å¾…æ©Ÿ: **100-1000**
- âš ï¸ ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹é€Ÿåº¦: **2-5 docs/sec**
- âš ï¸ æ¤œç´¢é€Ÿåº¦: **500-1000 ms**
- âš ï¸ ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: **yellow**

### ç·Šæ€¥å¯¾å¿œãŒå¿…è¦ãªçŠ¶æ…‹
- ğŸš¨ DLQ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸: **> 1000**
- ğŸš¨ ãƒ¡ã‚¤ãƒ³ã‚­ãƒ¥ãƒ¼å¾…æ©Ÿ: **> 1000**
- ğŸš¨ ãƒ¡ã‚¤ãƒ³ã‚­ãƒ¥ãƒ¼å‡¦ç†ä¸­: **0**ï¼ˆãƒ¯ãƒ¼ã‚«ãƒ¼åœæ­¢ï¼‰
- ğŸš¨ ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹é€Ÿåº¦: **< 2 docs/sec**
- ğŸš¨ æ¤œç´¢é€Ÿåº¦: **> 1000 ms**
- ğŸš¨ ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: **red**

---

## ã‚ˆãã‚ã‚‹è³ªå•ï¼ˆFAQï¼‰

### Q1: ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å®Ÿè¡Œã«AWSèªè¨¼ãŒå¿…è¦ã§ã™ã‹ï¼Ÿ

**A**: ã¯ã„ã€å¿…è¦ã§ã™ã€‚EC2ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®IAMãƒ­ãƒ¼ãƒ«ã«ä»¥ä¸‹ã®æ¨©é™ãŒå¿…è¦ã§ã™:
- SQS: `GetQueueAttributes`, `ReceiveMessage`, `SendMessage`, `DeleteMessage`
- OpenSearch: ãƒ‰ãƒ¡ã‚¤ãƒ³ã¸ã®HTTPã‚¢ã‚¯ã‚»ã‚¹

### Q2: æœ€é©åŒ–ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’æœ¬ç•ªç’°å¢ƒã§å®Ÿè¡Œã—ã¦ã‚‚å¤§ä¸ˆå¤«ã§ã™ã‹ï¼Ÿ

**A**: ä»¥ä¸‹ã®ç‚¹ã‚’ç¢ºèªã—ã¦ã‹ã‚‰å®Ÿè¡Œã—ã¦ãã ã•ã„:
- OpenSearchã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã«ååˆ†ãªå®¹é‡ãŒã‚ã‚‹
- ä»–ã®æœ¬ç•ªãƒ¯ãƒ¼ã‚¯ãƒ­ãƒ¼ãƒ‰ã«å½±éŸ¿ãŒãªã„ãƒ”ãƒ¼ã‚¯æ™‚é–“å¤–
- ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãŒæœ€æ–°ã§ã‚ã‚‹

### Q3: ãƒªã‚«ãƒãƒªãƒ¼ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸå ´åˆã¯ï¼Ÿ

**A**: ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯è‡ªå‹•çš„ã«ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚’è¡Œã„ã¾ã™ãŒã€ä»¥ä¸‹ã‚’ç¢ºèªã—ã¦ãã ã•ã„:
1. CloudWatch Logsã§ã‚¨ãƒ©ãƒ¼ã®è©³ç´°ã‚’ç¢ºèª
2. `check_opensearch.sh`ã§ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ãƒ˜ãƒ«ã‚¹ã‚’ç¢ºèª
3. å¿…è¦ã«å¿œã˜ã¦ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å†å®Ÿè¡Œï¼ˆå†ªç­‰æ€§ã‚’ç¢ºä¿ï¼‰

### Q4: ç›£è¦–ã‚’è‡ªå‹•åŒ–ã§ãã¾ã™ã‹ï¼Ÿ

**A**: ã¯ã„ã€ä»¥ä¸‹ã®æ–¹æ³•ãŒã‚ã‚Šã¾ã™:
```bash
# cronã§å®šæœŸçš„ã«ãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆ
*/15 * * * * /home/ec2-user/performance_report.sh >> /var/log/performance.log 2>&1

# CloudWatch Logsã«é€ä¿¡
*/5 * * * * /home/ec2-user/monitor_recovery.sh 2>&1 | logger -t dlq-recovery
```

---

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒå®Ÿè¡Œã§ããªã„

```bash
# å®Ÿè¡Œæ¨©é™ã‚’ç¢ºèª
ls -la *.sh

# å®Ÿè¡Œæ¨©é™ã‚’ä»˜ä¸
chmod +x *.sh

# ã‚·ã‚§ãƒãƒ³ã®ç¢ºèª
head -n 1 *.sh
```

### AWSèªè¨¼ã‚¨ãƒ©ãƒ¼

```bash
# IAMãƒ­ãƒ¼ãƒ«ã®ç¢ºèª
aws sts get-caller-identity

# ç’°å¢ƒå¤‰æ•°ã®ç¢ºèª
echo $AWS_DEFAULT_REGION
echo $AWS_REGION
```

### ä¾å­˜é–¢ä¿‚ã‚¨ãƒ©ãƒ¼

```bash
# å¿…è¦ãªãƒ„ãƒ¼ãƒ«ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
sudo yum install -y jq bc

# Pythonãƒ©ã‚¤ãƒ–ãƒ©ãƒª
pip3 install boto3
```

---

## ã¾ã¨ã‚

ã“ã®ãƒ„ãƒ¼ãƒ«ã‚»ãƒƒãƒˆã«ã‚ˆã‚Šã€DLQãƒªã‚«ãƒãƒªãƒ¼ã®å®Œå…¨ãªå¯è¦–åŒ–ã¨æœ€é©åŒ–ãŒå¯èƒ½ã«ãªã‚Šã¾ã™:

1. **monitor_recovery.sh**: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã®é€²æ—ç›£è¦–
2. **check_opensearch.sh**: ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§ã®æ¤œè¨¼
3. **optimize_recovery.sh**: å‡¦ç†é€Ÿåº¦ã®åŠ‡çš„ãªå‘ä¸Šï¼ˆ5-10å€ï¼‰
4. **performance_report.sh**: åŒ…æ‹¬çš„ãªã‚·ã‚¹ãƒ†ãƒ åˆ†æ

ç¾åœ¨ã®çŠ¶æ³ï¼ˆ8,163ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼‰ã§ã¯ã€æœ€é©åŒ–ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€**ç´„2-3åˆ†ã§å®Œå…¨ã«ãƒªã‚«ãƒãƒªãƒ¼**ã§ãã¾ã™ã€‚

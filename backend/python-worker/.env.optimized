# Optimized Environment Variables for Worker
# Copy this file to .env and adjust values as needed

# ========================================
# AWS Configuration
# ========================================
AWS_REGION=ap-northeast-1
S3_BUCKET=cis-filesearch-storage

# ========================================
# SQS Configuration - OPTIMIZED
# ========================================
# IMPORTANT: Update this with your actual queue URL
SQS_QUEUE_URL=https://sqs.ap-northeast-1.amazonaws.com/YOUR_ACCOUNT_ID/file-processing-queue-production

# Batch size - INCREASED from 1 to 10 for 5x faster processing
SQS_MAX_MESSAGES=10

# Long polling - Already optimal
SQS_WAIT_TIME=20

# Visibility timeout - INCREASED from 300 to 900 for complex files
SQS_VISIBILITY_TIMEOUT=900

# ========================================
# OpenSearch Configuration
# ========================================
# IMPORTANT: Update this with your actual OpenSearch endpoint
OPENSEARCH_ENDPOINT=https://your-opensearch-endpoint.ap-northeast-1.es.amazonaws.com
OPENSEARCH_INDEX=file-index
OPENSEARCH_USE_SSL=true
OPENSEARCH_VERIFY_CERTS=true

# ========================================
# Processing Configuration - OPTIMIZED
# ========================================
# Worker processes - For t3.medium (2 vCPU), use 1 worker
# Formula: CPU_COUNT - 1 (leave 1 for main process)
MAX_WORKERS=1

# Timeouts - INCREASED for better handling
PROCESSING_TIMEOUT=600
OCR_TIMEOUT=300

# File size limits (MB)
MAX_FILE_SIZE_MB=100
MAX_IMAGE_SIZE_MB=50
MAX_OFFICE_SIZE_MB=100
MAX_PDF_SIZE_MB=100

# Retry configuration
MAX_RETRIES=3
RETRY_DELAY=5

# ========================================
# OCR Configuration - OPTIMIZED
# ========================================
# DPI - REDUCED from 300 to 200 for 50% faster OCR
PDF_DPI=200

# Language settings
OCR_LANGUAGE=jpn+eng

# Image preprocessing
IMAGE_PREPROCESSING=true

# Confidence threshold
MIN_OCR_CONFIDENCE=50.0

# Page limits - REDUCED from 1000 to 100 for better performance
MAX_PDF_PAGES=100

# ========================================
# Memory Management - OPTIMIZED
# ========================================
# Temporary directory
TEMP_DIR=/tmp/file-processor

# ENABLED - Clean up temp files after processing
CLEANUP_TEMP_FILES=true

# ========================================
# Logging Configuration
# ========================================
LOG_LEVEL=INFO
LOG_FILE=/var/log/file-processor.log

# CloudWatch integration - RECOMMENDED
USE_CLOUDWATCH=true
CLOUDWATCH_LOG_GROUP=/aws/ec2/file-processor
CLOUDWATCH_LOG_STREAM=worker

# ========================================
# Thumbnail Configuration
# ========================================
THUMBNAIL_WIDTH=200
THUMBNAIL_HEIGHT=200
THUMBNAIL_QUALITY=85
THUMBNAIL_FORMAT=JPEG

THUMBNAIL_IMAGES=true
THUMBNAIL_PDFS=true
THUMBNAIL_OFFICE=true
THUMBNAIL_DOCUWORKS=true

# ========================================
# DocuWorks Configuration (Optional)
# ========================================
DOCUWORKS_EXTRACT_TEXT=true
DOCUWORKS_EXTRACT_IMAGES=false
DOCUWORKS_TO_PDF=false
DOCUWORKS_OCR_FALLBACK=true

# ========================================
# Performance Tuning
# ========================================
# These are used internally by worker_optimized.py

# Garbage collection interval (files)
GC_INTERVAL=50

# Resource health check thresholds
MIN_FREE_MEMORY_MB=500
MIN_FREE_DISK_GB=2

# Batch indexing size
OPENSEARCH_BATCH_SIZE=100

<mxfile host="app.diagrams.net" modified="2025-01-18T00:00:00.000Z" agent="Claude Code" version="24.7.17">
  <diagram name="Pattern3-Architecture" id="pattern3-arch">
    <mxGraphModel dx="2000" dy="1600" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="2400" pageHeight="1800" math="0" shadow="0">
      <root>
        <mxCell id="0"/>
        <mxCell id="1" parent="0"/>

        <!-- Title -->
        <mxCell id="title" value="CIS File Search - Pattern 3 Architecture&#xa;月次バッチ同期アーキテクチャ (NAS-AWS ハイブリッド) | Route53 + ACM追加&#xa;月額コスト: $47.74/月 (削減率 96%)" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=18;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="400" y="10" width="1200" height="80" as="geometry"/>
        </mxCell>

        <!-- On-Premise Environment -->
        <mxCell id="onprem" value="オンプレミス環境" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#F5F5F5;strokeColor=#666666;strokeWidth=3;verticalAlign=top;fontSize=16;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="50" y="120" width="400" height="900" as="geometry"/>
        </mxCell>

        <!-- AWS Cloud -->
        <mxCell id="aws" value="AWS Cloud (ap-northeast-1)" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#FFF7E6;strokeColor=#FF9900;strokeWidth=3;verticalAlign=top;fontSize=16;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="500" y="120" width="1850" height="1600" as="geometry"/>
        </mxCell>

        <!-- VPC Container -->
        <mxCell id="vpc" value="VPC: 10.0.0.0/16" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#E8F4F8;strokeColor=#0277BD;strokeWidth=3;verticalAlign=top;fontSize=14;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="540" y="180" width="1300" height="900" as="geometry"/>
        </mxCell>

        <!-- Internet Gateway -->
        <mxCell id="igw" value="Internet Gateway&#xa;インターネット接続" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#C8E6C9;strokeColor=#388E3C;strokeWidth=2;fontSize=12" vertex="1" parent="1">
          <mxGeometry x="580" y="220" width="200" height="80" as="geometry"/>
        </mxCell>

        <!-- Virtual Private Gateway -->
        <mxCell id="vpg" value="Virtual Private Gateway&#xa;Site-to-Site VPN&#xa;月4時間のみ接続&#xa;2:00-6:00 (月1日)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#FF9900;strokeWidth=2;fontSize=12" vertex="1" parent="1">
          <mxGeometry x="580" y="330" width="200" height="120" as="geometry"/>
        </mxCell>

        <!-- Public Subnet -->
        <mxCell id="publicSubnet" value="Public Subnet: 10.0.0.0/24 (AZ-a)" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#BBDEFB;strokeColor=#1976D2;strokeWidth=2;verticalAlign=top;fontSize=13;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="820" y="220" width="350" height="200" as="geometry"/>
        </mxCell>

        <!-- NAT Gateway in Public Subnet -->
        <mxCell id="nat" value="NAT Gateway&#xa;Elastic IP&#xa;インターネット経由&#xa;アクセス制御" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFFDE7;strokeColor=#F57F17;strokeWidth=2;fontSize=12" vertex="1" parent="1">
          <mxGeometry x="850" y="270" width="280" height="120" as="geometry"/>
        </mxCell>

        <!-- Private Subnet 1 -->
        <mxCell id="privateSubnet1" value="Private Subnet 1: 10.0.1.0/24 (AZ-a)" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#FCE4EC;strokeColor=#C2185B;strokeWidth=2;verticalAlign=top;fontSize=13;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="820" y="450" width="550" height="600" as="geometry"/>
        </mxCell>

        <!-- Lambda Functions in Private Subnet 1 -->
        <mxCell id="vpnMgr" value="VPNManager&#xa;Python 3.11&#xa;512MB ARM64&#xa;- VPN接続制御&#xa;- 接続監視" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#0066CC;strokeWidth=2;fontSize=11" vertex="1" parent="1">
          <mxGeometry x="850" y="500" width="180" height="110" as="geometry"/>
        </mxCell>

        <mxCell id="fileScanner" value="FileScanner&#xa;Node.js 20&#xa;1024MB ARM64&#xa;- S3全スキャン&#xa;- メタデータ収集" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#0066CC;strokeWidth=2;fontSize=11" vertex="1" parent="1">
          <mxGeometry x="1060" y="500" width="180" height="110" as="geometry"/>
        </mxCell>

        <mxCell id="textExt" value="TextExtractor&#xa;Python 3.11&#xa;2048MB ARM64&#xa;- PDF解析&#xa;月5,000実行" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#0066CC;strokeWidth=2;fontSize=11" vertex="1" parent="1">
          <mxGeometry x="850" y="640" width="180" height="110" as="geometry"/>
        </mxCell>

        <mxCell id="imgExt" value="ImageFeatureExtractor&#xa;Python 3.11&#xa;2048MB ARM64&#xa;- ResNet-50&#xa;月2,000実行" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#0066CC;strokeWidth=2;fontSize=11" vertex="1" parent="1">
          <mxGeometry x="1060" y="640" width="180" height="110" as="geometry"/>
        </mxCell>

        <mxCell id="bulkIdx" value="BulkIndexer&#xa;Node.js 20&#xa;1024MB ARM64&#xa;- Bulk API&#xa;- DynamoDB更新" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#0066CC;strokeWidth=2;fontSize=11" vertex="1" parent="1">
          <mxGeometry x="850" y="780" width="180" height="110" as="geometry"/>
        </mxCell>

        <!-- OpenSearch in Private Subnet 1 -->
        <mxCell id="opensearch" value="OpenSearch Service&#xa;t3.small.search&#xa;vCPU: 2, RAM: 2GB&#xa;50GB gp3&#xa;- kuromoji (日本語)&#xa;- k-NN (画像類似)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#00AA00;strokeWidth=2;fontSize=12" vertex="1" parent="1">
          <mxGeometry x="1060" y="780" width="220" height="150" as="geometry"/>
        </mxCell>

        <!-- Private Subnet 2 -->
        <mxCell id="privateSubnet2" value="Private Subnet 2: 10.0.2.0/24 (AZ-b)" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#F3E5F5;strokeColor=#7B1FA2;strokeWidth=2;verticalAlign=top;fontSize=13;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="1400" y="450" width="400" height="300" as="geometry"/>
        </mxCell>

        <!-- SearchAPI in Private Subnet 2 -->
        <mxCell id="searchAPI" value="SearchAPI&#xa;Node.js 20&#xa;512MB ARM64&#xa;POST /api/search&#xa;月10,000実行&#xa;&#xa;Multi-AZ冗長性" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#00AA00;strokeWidth=2;fontSize=12" vertex="1" parent="1">
          <mxGeometry x="1450" y="520" width="280" height="150" as="geometry"/>
        </mxCell>

        <!-- User Layer -->
        <mxCell id="userLayer" value="ユーザー層" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#E3F2FD;strokeColor=#1976D2;strokeWidth=2;verticalAlign=top;fontSize=14;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="50" y="1100" width="400" height="420" as="geometry"/>
        </mxCell>

        <!-- On-Premise Components -->
        <mxCell id="nas" value="NAS Server&#xa;SMB/NFS&#xa;500GB&#xa;1,000,000 files" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#0066CC;strokeWidth=2;fontSize=12" vertex="1" parent="1">
          <mxGeometry x="100" y="180" width="300" height="100" as="geometry"/>
        </mxCell>

        <mxCell id="dsAgent" value="DataSync Agent&#xa;増分検出エージェント&#xa;version: 1.0.52" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#0066CC;strokeWidth=2;fontSize=12" vertex="1" parent="1">
          <mxGeometry x="100" y="320" width="300" height="100" as="geometry"/>
        </mxCell>

        <mxCell id="vpnRouter" value="VPN Router&#xa;Customer Gateway&#xa;Cisco ASA 5506" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#0066CC;strokeWidth=2;fontSize=12" vertex="1" parent="1">
          <mxGeometry x="100" y="460" width="300" height="100" as="geometry"/>
        </mxCell>

        <!-- AWS Managed Services (Outside VPC) -->
        <mxCell id="managedLayer" value="マネージドサービス層（VPC外）" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#FFF9C4;strokeColor=#F57F17;strokeWidth=2;verticalAlign=top;fontSize=14;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="540" y="1120" width="800" height="380" as="geometry"/>
        </mxCell>

        <!-- AWS Transfer Layer -->
        <mxCell id="dataSync" value="AWS DataSync&#xa;増分同期: 20GB/月&#xa;転送レート: 100Mbps&#xa;転送時間: 約3時間" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#FF9900;strokeWidth=2;fontSize=12" vertex="1" parent="1">
          <mxGeometry x="580" y="1170" width="300" height="120" as="geometry"/>
        </mxCell>

        <!-- AWS Storage Layer -->
        <mxCell id="s3" value="S3 Bucket&#xa;Intelligent-Tiering&#xa;100GB&#xa;- 抽出テキスト: 40GB&#xa;- 画像特徴量: 10GB&#xa;- サムネイル: 30GB&#xa;- ログ: 20GB" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#00AA00;strokeWidth=2;fontSize=12" vertex="1" parent="1">
          <mxGeometry x="580" y="1320" width="300" height="150" as="geometry"/>
        </mxCell>

        <!-- AWS Database -->
        <mxCell id="dynamodb" value="DynamoDB&#xa;On-Demand&#xa;- file_metadata: 5GB&#xa;- sync_jobs: 100MB" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#00AA00;strokeWidth=2;fontSize=12" vertex="1" parent="1">
          <mxGeometry x="920" y="1170" width="220" height="110" as="geometry"/>
        </mxCell>

        <!-- AWS Orchestration -->
        <mxCell id="orchestrationLayer" value="オーケストレーション層" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#E8EAF6;strokeColor=#3F51B5;strokeWidth=2;verticalAlign=top;fontSize=14;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="1370" y="1120" width="450" height="380" as="geometry"/>
        </mxCell>

        <mxCell id="stepFunc" value="Step Functions&#xa;MonthlyBatchSyncWorkflow&#xa;実行頻度: 月1回&#xa;実行時間: 5-6時間" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#0066CC;strokeWidth=2;fontSize=12" vertex="1" parent="1">
          <mxGeometry x="1410" y="1170" width="360" height="100" as="geometry"/>
        </mxCell>

        <mxCell id="eventBridge" value="EventBridge&#xa;cron(0 2 1 * ? *)&#xa;毎月1日 深夜2時" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#0066CC;strokeWidth=2;fontSize=12" vertex="1" parent="1">
          <mxGeometry x="1410" y="1300" width="160" height="100" as="geometry"/>
        </mxCell>

        <mxCell id="sns" value="SNS&#xa;BatchNotifications&#xa;管理者メール × 5" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#0066CC;strokeWidth=2;fontSize=12" vertex="1" parent="1">
          <mxGeometry x="1610" y="1300" width="160" height="100" as="geometry"/>
        </mxCell>

        <!-- AWS Monitoring -->
        <mxCell id="cloudwatch" value="CloudWatch&#xa;Logs: 2GB/月&#xa;Metrics: 10個&#xa;Alarms: 5個" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#00BCD4;strokeWidth=2;fontSize=12" vertex="1" parent="1">
          <mxGeometry x="920" y="1320" width="220" height="120" as="geometry"/>
        </mxCell>

        <!-- User Components -->
        <mxCell id="user" value="ユーザー&#xa;社内50名&#xa;Azure AD SSO" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#00AA00;strokeWidth=2;fontSize=12" vertex="1" parent="1">
          <mxGeometry x="100" y="1150" width="300" height="100" as="geometry"/>
        </mxCell>

        <mxCell id="nextjs" value="Next.js Frontend&#xa;ECS Fargate&#xa;vCPU: 0.25, RAM: 0.5GB&#xa;TypeScript + Tailwind" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#00AA00;strokeWidth=2;fontSize=12" vertex="1" parent="1">
          <mxGeometry x="100" y="1290" width="300" height="100" as="geometry"/>
        </mxCell>

        <!-- DNS & API Gateway Layer -->
        <mxCell id="dnsLayer" value="DNS & API Gateway層" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#FCE4EC;strokeColor=#880E4F;strokeWidth=2;verticalAlign=top;fontSize=14;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="1400" y="800" width="400" height="260" as="geometry"/>
        </mxCell>

        <mxCell id="route53" value="Route53&#xa;filesearch.company.com&#xa;Hosted Zone&#xa;$0.50/月" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#E91E63;strokeWidth=2;fontSize=12" vertex="1" parent="1">
          <mxGeometry x="1450" y="850" width="140" height="100" as="geometry"/>
        </mxCell>

        <mxCell id="apiGateway" value="API Gateway&#xa;Custom Domain&#xa;ACM証明書 (無料)&#xa;HTTPS (TLS 1.3)&#xa;IPアドレス制限&#xa;スロットリング: 100req/秒" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#9C27B0;strokeWidth=2;fontSize=11" vertex="1" parent="1">
          <mxGeometry x="1620" y="850" width="150" height="140" as="geometry"/>
        </mxCell>

        <mxCell id="acm" value="ACM Certificate&#xa;*.company.com&#xa;DNS検証&#xa;自動更新&#xa;無料" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#E91E63;strokeWidth=2;fontSize=11" vertex="1" parent="1">
          <mxGeometry x="1450" y="970" width="140" height="80" as="geometry"/>
        </mxCell>

        <!-- On-Premise Connections -->
        <mxCell id="conn1" value="" style="endArrow=classic;html=1;strokeWidth=2;strokeColor=#0066CC;" edge="1" parent="1" source="nas" target="dsAgent">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="250" y="300" as="sourcePoint"/>
            <mxPoint x="300" y="250" as="targetPoint"/>
          </mxGeometry>
        </mxCell>

        <mxCell id="conn2" value="" style="endArrow=classic;html=1;strokeWidth=2;strokeColor=#0066CC;" edge="1" parent="1" source="dsAgent" target="vpnRouter">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="250" y="440" as="sourcePoint"/>
            <mxPoint x="300" y="390" as="targetPoint"/>
          </mxGeometry>
        </mxCell>

        <!-- VPN Connection (Dashed) -->
        <mxCell id="vpnConn" value="VPN接続&#xa;月4時間のみ&#xa;暗号化通信" style="endArrow=classic;html=1;strokeWidth=3;strokeColor=#0066CC;dashed=1;dashPattern=8 8;" edge="1" parent="1" source="vpnRouter" target="vpg">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="410" y="510" as="sourcePoint"/>
            <mxPoint x="570" y="390" as="targetPoint"/>
          </mxGeometry>
        </mxCell>

        <!-- IGW to NAT Connection -->
        <mxCell id="igwNat" value="ルーティング" style="endArrow=classic;html=1;strokeWidth=2;strokeColor=#388E3C;" edge="1" parent="1" source="igw" target="nat">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="780" y="260" as="sourcePoint"/>
            <mxPoint x="840" y="320" as="targetPoint"/>
          </mxGeometry>
        </mxCell>

        <!-- NAT to Lambda Connections (Dashed - Internet Access) -->
        <mxCell id="natLambda1" value="インターネット&#xa;アクセス" style="endArrow=classic;html=1;strokeWidth=1;strokeColor=#F57F17;dashed=1;dashPattern=4 4;" edge="1" parent="1" source="nat" target="vpnMgr">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="990" y="400" as="sourcePoint"/>
            <mxPoint x="940" y="490" as="targetPoint"/>
          </mxGeometry>
        </mxCell>

        <!-- Batch Flow -->
        <mxCell id="batch1" value="① 月1回トリガー" style="endArrow=classic;html=1;strokeWidth=3;strokeColor=#0066CC;" edge="1" parent="1" source="eventBridge" target="stepFunc">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1490" y="1290" as="sourcePoint"/>
            <mxPoint x="1590" y="1270" as="targetPoint"/>
          </mxGeometry>
        </mxCell>

        <!-- Data Transfer Flow -->
        <mxCell id="transfer1" value="増分データ転送&#xa;20GB/月, 3時間" style="endArrow=classic;html=1;strokeWidth=4;strokeColor=#FF9900;" edge="1" parent="1" source="vpg" target="dataSync">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="680" y="460" as="sourcePoint"/>
            <mxPoint x="680" y="1160" as="targetPoint"/>
          </mxGeometry>
        </mxCell>

        <mxCell id="transfer2" value="" style="endArrow=classic;html=1;strokeWidth=4;strokeColor=#FF9900;" edge="1" parent="1" source="dataSync" target="s3">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="730" y="1300" as="sourcePoint"/>
            <mxPoint x="730" y="1310" as="targetPoint"/>
          </mxGeometry>
        </mxCell>

        <!-- Search Flow -->
        <mxCell id="search1" value="HTTPS&#xa;Azure AD認証" style="endArrow=classic;startArrow=classic;html=1;strokeWidth=2;strokeColor=#00AA00;" edge="1" parent="1" source="user" target="nextjs">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="250" y="1260" as="sourcePoint"/>
            <mxPoint x="250" y="1280" as="targetPoint"/>
          </mxGeometry>
        </mxCell>

        <mxCell id="search2" value="HTTPS&#xa;filesearch.company.com" style="endArrow=classic;html=1;strokeWidth=2;strokeColor=#00AA00;" edge="1" parent="1" source="nextjs" target="route53">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="410" y="1340" as="sourcePoint"/>
            <mxPoint x="1440" y="900" as="targetPoint"/>
          </mxGeometry>
        </mxCell>

        <mxCell id="search3" value="DNS解決" style="endArrow=classic;html=1;strokeWidth=2;strokeColor=#00AA00;" edge="1" parent="1" source="route53" target="apiGateway">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1600" y="900" as="sourcePoint"/>
            <mxPoint x="1610" y="900" as="targetPoint"/>
          </mxGeometry>
        </mxCell>

        <mxCell id="search4" value="TLS 1.3&#xa;証明書検証" style="endArrow=classic;html=1;strokeWidth=1;strokeColor=#E91E63;dashed=1;dashPattern=4 4;" edge="1" parent="1" source="apiGateway" target="acm">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1680" y="1000" as="sourcePoint"/>
            <mxPoint x="1600" y="1010" as="targetPoint"/>
          </mxGeometry>
        </mxCell>

        <mxCell id="search5" value="POST /api/search&#xa;IPアドレス制限チェック" style="endArrow=classic;html=1;strokeWidth=2;strokeColor=#00AA00;" edge="1" parent="1" source="apiGateway" target="searchAPI">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1700" y="730" as="sourcePoint"/>
            <mxPoint x="1590" y="520" as="targetPoint"/>
          </mxGeometry>
        </mxCell>

        <!-- Lambda to OpenSearch -->
        <mxCell id="lambdaOS" value="" style="endArrow=classic;html=1;strokeWidth=2;strokeColor=#00AA00;" edge="1" parent="1" source="bulkIdx" target="opensearch">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1040" y="850" as="sourcePoint"/>
            <mxPoint x="1060" y="850" as="targetPoint"/>
          </mxGeometry>
        </mxCell>

        <!-- Legend -->
        <mxCell id="legend" value="凡例&#xa;━━━ バッチ同期フロー (月1回) [青]&#xa;━━━ データ転送 (増分20GB) [オレンジ]&#xa;━━━ 検索フロー (リアルタイム) [緑]&#xa;- - - VPN接続 (月4時間のみ) [青破線]&#xa;· · · インターネットアクセス [黄点線]" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#666666;strokeWidth=1;verticalAlign=top;fontSize=11;align=left" vertex="1" parent="1">
          <mxGeometry x="1870" y="200" width="400" height="150" as="geometry"/>
        </mxCell>

        <!-- Subnet Info -->
        <mxCell id="subnetInfo" value="サブネット構成&#xa;━━━━━━━━━━━━━━━━━━&#xa;Public Subnet (10.0.0.0/24)&#xa;  ・NAT Gateway (Elastic IP)&#xa;  ・Internet Gateway経由&#xa;&#xa;Private Subnet 1 (10.0.1.0/24, AZ-a)&#xa;  ・Lambda Functions (バッチ処理)&#xa;  ・OpenSearch Service&#xa;  ・NAT Gateway経由でインターネット&#xa;&#xa;Private Subnet 2 (10.0.2.0/24, AZ-b)&#xa;  ・SearchAPI Lambda (Multi-AZ)" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#E8F4F8;strokeColor=#0277BD;strokeWidth=2;verticalAlign=top;fontSize=11;align=left;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="1870" y="380" width="400" height="280" as="geometry"/>
        </mxCell>

        <!-- Cost Breakdown -->
        <mxCell id="cost" value="コスト構成 ($47.74/月)&#xa;━━━━━━━━━━━━━━━━━━&#xa;* OpenSearch: $31.46 (65.9%)&#xa;* DataSync: $5.00 (10.5%)&#xa;* CloudWatch: $4.00 (8.4%)&#xa;* S3: $2.18 (4.6%)&#xa;* Lambda: $1.35 (2.8%)&#xa;* Route53: $0.50 (1.0%)&#xa;* ACM: $0.00 (無料)&#xa;* その他: $3.25 (6.8%)&#xa;&#xa;削減率: 96% (Pattern 2比)&#xa;HTTPS対応: ACM証明書 (無料)" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#E8F5E9;strokeColor=#4CAF50;strokeWidth=2;verticalAlign=top;fontSize=11;align=left;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="1870" y="690" width="400" height="260" as="geometry"/>
        </mxCell>

        <!-- Key Features -->
        <mxCell id="features" value="主要な特徴&#xa;━━━━━━━━━━━━━━━━━━&#xa;・月1回の増分同期 (VPN接続: 月4時間のみ)&#xa;・HTTPS暗号化 (ACM証明書無料、Route53 $0.50/月)&#xa;・ファイル実体はNASに保持&#xa;・メタデータ+テキストのみAWSで管理&#xa;・全文検索 (kuromoji) + 画像類似検索 (k-NN)&#xa;・100万ファイル対応&#xa;・ARM64 (Graviton2) 最適化" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#FFF3E0;strokeColor=#FF9800;strokeWidth=2;verticalAlign=top;fontSize=11;align=left;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="1870" y="970" width="400" height="200" as="geometry"/>
        </mxCell>

        <!-- Batch Timing -->
        <mxCell id="timing" value="バッチ実行タイミング&#xa;━━━━━━━━━━━━━━━━━━&#xa;・毎月1日 深夜2時 (JST)&#xa;・VPN接続時間: 2:00-6:00 (4時間)&#xa;・Lambda処理: VPN切断後1-2時間&#xa;・合計処理時間: 5-6時間" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#E3F2FD;strokeColor=#2196F3;strokeWidth=2;verticalAlign=top;fontSize=11;align=left;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="1870" y="1170" width="400" height="160" as="geometry"/>
        </mxCell>

        <!-- Monitoring -->
        <mxCell id="monitoring" value="監視項目&#xa;━━━━━━━━━━━━━━━━━━&#xa;・VPN接続成功率&#xa;・DataSync転送完了時間&#xa;・Lambda並列実行数&#xa;・OpenSearchインデックス成功率&#xa;・検索レスポンスタイム" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#E0F7FA;strokeColor=#00BCD4;strokeWidth=2;verticalAlign=top;fontSize=11;align=left;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="1870" y="1360" width="400" height="150" as="geometry"/>
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>
</mxfile>

# Pattern 3 アーキテクチャ図 - draw.io作成ガイド一式

このディレクトリには、CISファイル検索システムのPattern 3（月次バッチ同期アーキテクチャ）をdraw.ioで作成するための包括的なドキュメント一式が含まれています。

---

## 📦 提供ドキュメント一覧

### 1. 📘 詳細ガイド
**ファイル**: `pattern3-drawio-guide.md`

**内容**:
- AWS公式アイコンライブラリの追加方法
- レイアウト設計（オンプレミス環境 + AWS Cloud）
- 全26コンポーネントの詳細配置リスト
- 接続線（矢印）30本の定義
- スタイリングガイド（色、フォント、シャドウ）
- レイヤー構成（4層）

**対象者**: 中級者以上、詳細な仕様を確認したい方

---

### 2. 📊 構造化データ（CSV形式）

#### 2-1. コンポーネントリスト
**ファイル**: `pattern3-components.csv`

**内容**:
- 全26コンポーネントの配置情報
- 位置座標（X, Y）、サイズ（W, H）
- 使用するAWSアイコン名
- ラベルテキスト
- 背景色とスタイル
- 用途メモ

**使い方**: Excel/Google Sheetsで開いて参照しながら配置

#### 2-2. 接続リスト
**ファイル**: `pattern3-connections.csv`

**内容**:
- 全30本の接続情報
- 始点・終点コンポーネント
- 接続タイプ（バッチフロー、検索フロー、監視ログ）
- ラベルテキスト
- 色、スタイル、線幅、矢印タイプ
- 注釈

**使い方**: 矢印を引く際のリファレンスとして利用

---

### 3. 🎨 PlantUML形式
**ファイル**: `pattern3-architecture.puml`

**内容**:
- AWS公式アイコンを使用したPlantUML図
- C4 Diagramスタイル
- バッチフロー、検索フロー、監視フローの色分け
- 凡例、コスト情報、注釈付き

**使い方**:
- draw.ioにインポート可能（`File → Import from → PlantUML`）
- オンラインエディタで編集: http://www.plantuml.com/plantuml/
- VSCodeの拡張機能「PlantUML」でプレビュー

**メリット**:
- テキストベースで編集可能
- バージョン管理が容易
- 自動レイアウト機能

---

### 4. 📖 ステップバイステップ作成手順書
**ファイル**: `pattern3-drawio-step-by-step.md`

**内容**:
- 初心者向けの詳細な作成手順（9ステップ）
- スクリーンショット説明付き
- 所要時間: 30-40分
- トラブルシューティングガイド
- エクスポート方法（PNG, PDF, SVG）

**対象者**: 初心者、draw.ioを初めて使う方

**ステップ構成**:
1. draw.ioを開く（2分）
2. AWS公式アイコンライブラリを追加（3分）
3. レイヤーを設定（5分）
4. 背景とVPC枠を作成（8分）
5. AWSコンポーネントを配置（12分）
6. 接続線（矢印）を追加（10分）
7. ラベルと注釈を追加（5分）
8. 仕上げと調整（5分）
9. 保存とエクスポート（3分）

---

### 5. 📐 元のMermaid形式
**ファイル**: `pattern3-architecture.md`

**内容**:
- Mermaid形式のアーキテクチャ図（元ソース）
- 全体構成図、シーケンス図、ステートマシン図
- コスト構成円グラフ
- OpenSearchインデックス構造

**使い方**: draw.io作成時のリファレンス、正確性の確認

---

## 🚀 クイックスタート

### 初めての方（初心者向け）

1. **`pattern3-drawio-step-by-step.md`** を開く
2. ステップ1から順番に実行
3. 約30-40分で完成

### 経験者向け

1. **`pattern3-drawio-guide.md`** で全体像を把握
2. **`pattern3-components.csv`** を参照しながらコンポーネント配置
3. **`pattern3-connections.csv`** を参照しながら接続線追加
4. 約20-30分で完成

### PlantUMLから開始したい方

1. **`pattern3-architecture.puml`** をダウンロード
2. draw.ioで「File → Import from → PlantUML」
3. インポートされた図を微調整
4. 約10-15分で完成

---

## 📏 アーキテクチャ図の仕様

### 基本情報

- **タイトル**: CIS File Search - Pattern 3 Architecture
- **サブタイトル**: 月次バッチ同期アーキテクチャ（NAS-AWS ハイブリッド）
- **キャンバスサイズ**: 2000px × 1600px（A3横向き）
- **コンポーネント数**: 26個
- **接続線数**: 30本
- **レイヤー数**: 4層

### 構成要素

#### オンプレミス環境（左側）
- NAS Server
- DataSync Agent
- VPN Router (Customer Gateway)

#### AWS Cloud環境（右側、VPC内）

**ネットワーク層**:
- Virtual Private Gateway

**データ転送層**:
- AWS DataSync

**ストレージ層**:
- S3 Bucket (Intelligent-Tiering, 100GB)

**バッチ処理層**:
- Step Functions
- Lambda × 5 (VPNManager, FileScanner, TextExtractor, ImageFeatureExtractor, BulkIndexer)

**API層**:
- SearchAPI Lambda

**検索エンジン層**:
- OpenSearch Service (t3.small.search, kuromoji + k-NN)

**メタデータDB層**:
- DynamoDB (On-Demand)

**オーケストレーション層**:
- EventBridge (月1回トリガー)
- SNS (通知)

**監視層**:
- CloudWatch (Logs/Metrics/Alarms)

#### ユーザー層
- User (50名)
- Next.js Frontend (ECS Fargate)

---

## 🎨 色使いガイド

### フロー別カラーコード

| フロー | 色 | 用途 |
|-------|-----|-----|
| バッチ同期フロー | `#0066CC` (青) | 月1回のバッチ処理 |
| データ転送フロー | `#FF9900` (オレンジ) | NAS → AWS データ転送 |
| 検索フロー | `#00AA00` (緑) | ユーザー検索リクエスト |
| VPN接続 | `#0066CC` (青・点線) | 月4時間のみの接続 |
| 監視ログ | `#00BCD4` (シアン・点線) | CloudWatch監視 |

### コンポーネント別カラーコード

| サービス | 背景色 | 枠線色 |
|---------|--------|--------|
| Lambda関数 | `#9C27B0` (紫) | `#4A148C` (濃紫) |
| S3 | `#FF9800` (オレンジ) | `#E65100` (濃オレンジ) |
| OpenSearch | `#4CAF50` (緑) | `#1B5E20` (濃緑) |
| DynamoDB | `#2196F3` (青) | `#0D47A1` (濃青) |
| Step Functions | `#FFF9C4` (淡黄) | `#F9A825` (黄) |
| EventBridge | `#FF5722` (赤オレンジ) | `#BF360C` (濃赤) |
| SNS | `#E91E63` (ピンク) | `#880E4F` (濃ピンク) |
| CloudWatch | `#00BCD4` (シアン) | `#006064` (濃シアン) |
| VPN系 | `#E8EAF6` (淡紫) | `#3F51B5` (紫) |
| DataSync | `#E0F2F1` (淡青緑) | `#00897B` (青緑) |
| Next.js | `#03A9F4` (ライトブルー) | `#01579B` (濃青) |

---

## 💰 コスト情報

図内に表示されるコスト情報:

### 月額コスト: $47.24/月

| サービス | 月額コスト | 構成比 |
|---------|-----------|-------|
| OpenSearch | $31.46 | 66.7% |
| DataSync | $5.00 | 10.6% |
| CloudWatch | $4.00 | 8.5% |
| S3 | $2.18 | 4.6% |
| Lambda | $1.35 | 2.9% |
| その他 | $3.25 | 6.7% |

**削減率**: 96% (Pattern 2比)

---

## ✅ 完成チェックリスト

図の完成度を確認するためのチェックリスト:

### コンポーネント配置
- [ ] オンプレミス環境（3個）
- [ ] ネットワーク層（1個）
- [ ] データ転送層（1個）
- [ ] ストレージ層（1個）
- [ ] バッチ処理層（6個）
- [ ] API層（1個）
- [ ] 検索エンジン層（1個）
- [ ] メタデータDB層（1個）
- [ ] オーケストレーション層（2個）
- [ ] 監視層（1個）
- [ ] ユーザー層（2個）
- [ ] 凡例・コスト情報（3個）

**合計**: 26個

### 接続線
- [ ] バッチ同期フロー（15本）
- [ ] VPN接続（1本）
- [ ] 検索フロー（5本）
- [ ] 監視ログフロー（6本）
- [ ] データ転送フロー（3本）

**合計**: 30本

### スタイリング
- [ ] 色使いが統一されている
- [ ] フォントサイズが適切
- [ ] ラベルが読みやすい
- [ ] VPN接続の点線が目立つ
- [ ] Lambda群がグループ化されている
- [ ] シャドウ効果が適用されている

### レイアウト
- [ ] オンプレミスとAWS Cloudの境界が明確
- [ ] コンポーネントが整列されている
- [ ] 矢印の経路が重なっていない
- [ ] 全体のバランスが良い

### 情報
- [ ] タイトルが表示されている
- [ ] 凡例が含まれている
- [ ] コスト情報が表示されている
- [ ] バージョン情報がある

---

## 📤 エクスポート形式

### PNG形式（プレゼンテーション用）
- **解像度**: 300 DPI
- **サイズ**: 2000px × 1600px
- **背景**: 白色
- **用途**: PowerPoint埋め込み、ドキュメント

### PDF形式（印刷用）
- **用紙サイズ**: A3 横向き
- **余白**: 10mm
- **品質**: 高品質印刷
- **用途**: 印刷配布、公式ドキュメント

### SVG形式（編集可能）
- **テキスト**: フォント埋め込み
- **リンク**: 保持
- **用途**: Web表示、編集可能な共有

### draw.io形式（オリジナル）
- **拡張子**: .drawio または .xml
- **用途**: 編集・更新、バージョン管理

---

## 🛠️ トラブルシューティング

### よくある質問

**Q1: AWSアイコンが見つかりません**
- A: 「More Shapes...」で「AWS 19」ライブラリを追加してください

**Q2: 矢印が綺麗に引けません**
- A: Connectorモードを使用し、接続ポイント（青い×）にスナップさせてください

**Q3: ラベルが重なって読めません**
- A: フォントサイズを小さくするか、ラベル位置を調整してください

**Q4: 印刷時にレイアウトが崩れます**
- A: PDF形式でエクスポートしてから印刷してください

**Q5: ファイルサイズが大きすぎます**
- A: PNG解像度を下げるか、SVG形式を使用してください

詳細は **`pattern3-drawio-step-by-step.md`** のトラブルシューティングセクションを参照してください。

---

## 📚 関連ドキュメント

### プロジェクト内
- `/docs/architecture.md` - システム全体のアーキテクチャ
- `/docs/requirement.md` - システム要件
- `/docs/aws-resource-sizing.md` - AWSリソースサイジング
- `/docs/CIS_AWS_Cost_Estimate_2Patterns.xlsx` - コスト見積もり

### 外部リソース
- [draw.io 公式サイト](https://www.diagrams.net/)
- [draw.io ドキュメント](https://www.diagrams.net/doc/)
- [AWS Architecture Icons](https://aws.amazon.com/jp/architecture/icons/)
- [PlantUML 公式サイト](https://plantuml.com/)
- [AWS アーキテクチャセンター](https://aws.amazon.com/jp/architecture/)

---

## 👥 サポート

### 質問・フィードバック

このガイドに関する質問やフィードバックは、プロジェクトの以下の担当者にお問い合わせください:

- **プロジェクトマネージャー**: CIS Project Team
- **アーキテクト**: システムアーキテクチャ担当
- **ドキュメント作成**: Business & Data Analyst

---

## 📝 更新履歴

| 版数 | 日付 | 更新内容 | 作成者 |
|-----|------|---------|--------|
| 1.0 | 2025-01-18 | Pattern 3 draw.io作成ガイド一式初版作成 | Claude (Business & Data Analyst) |

---

## 📄 ライセンス

このドキュメント一式は、CISファイル検索システムプロジェクトの一部として管理されています。
プロジェクト内部での使用および共有は自由ですが、外部への配布には承認が必要です。

---

**Happy Diagramming! 🎨**

Pattern 3アーキテクチャ図の作成を楽しんでください!

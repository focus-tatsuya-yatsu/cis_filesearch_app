<mxfile host="app.diagrams.net" modified="2025-10-20T00:00:00.000Z" agent="Claude Code" version="24.0.0" type="device">
  <diagram name="Pattern3-Architecture" id="pattern3-arch">
    <mxGraphModel dx="2400" dy="1400" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="3200" pageHeight="2400" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />

        <!-- Title -->
        <mxCell id="title" value="CIS File Search - Pattern 3 Architecture&#xa;S3静的ホスティング + CloudFront + Cognito認証&#xa;月額コスト: $51.79/月 (ECS Fargate比 -26.3%)" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=18;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="800" y="20" width="800" height="80" as="geometry" />
        </mxCell>

        <!-- User Layer -->
        <mxCell id="user-container" value="ユーザー層" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E1F5FE;strokeColor=#01579B;verticalAlign=top;fontSize=14;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="80" y="140" width="200" height="180" as="geometry" />
        </mxCell>
        <mxCell id="user-icon" value="" style="sketch=0;outlineConnect=0;fontColor=#232F3E;gradientColor=none;fillColor=#232F3D;strokeColor=none;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=12;fontStyle=0;aspect=fixed;pointerEvents=1;shape=mxgraph.aws4.users;" vertex="1" parent="1">
          <mxGeometry x="140" y="180" width="78" height="78" as="geometry" />
        </mxCell>
        <mxCell id="user-label" value="社内ユーザー 50名&#xa;ブラウザアクセス" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12" vertex="1" parent="1">
          <mxGeometry x="100" y="268" width="160" height="40" as="geometry" />
        </mxCell>

        <!-- Frontend & CDN Layer -->
        <mxCell id="cdn-container" value="フロントエンド配信層（CDN）" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E1F5FE;strokeColor=#01579B;verticalAlign=top;fontSize=14;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="360" y="140" width="600" height="380" as="geometry" />
        </mxCell>

        <!-- Route53 -->
        <mxCell id="route53" value="" style="sketch=0;outlineConnect=0;fontColor=#232F3E;gradientColor=none;fillColor=#8C4FFF;strokeColor=none;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=12;fontStyle=0;aspect=fixed;pointerEvents=1;shape=mxgraph.aws4.route_53;" vertex="1" parent="1">
          <mxGeometry x="400" y="180" width="78" height="78" as="geometry" />
        </mxCell>
        <mxCell id="route53-label" value="Route53&#xa;filesearch.company.com&#xa;$0.50/月" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=11" vertex="1" parent="1">
          <mxGeometry x="370" y="263" width="138" height="50" as="geometry" />
        </mxCell>

        <!-- CloudFront -->
        <mxCell id="cloudfront" value="" style="sketch=0;outlineConnect=0;fontColor=#232F3E;gradientColor=none;fillColor=#8C4FFF;strokeColor=none;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=12;fontStyle=0;aspect=fixed;pointerEvents=1;shape=mxgraph.aws4.cloudfront;" vertex="1" parent="1">
          <mxGeometry x="580" y="180" width="78" height="78" as="geometry" />
        </mxCell>
        <mxCell id="cloudfront-label" value="CloudFront&#xa;Custom Domain&#xa;TLS 1.3 (ACM)&#xa;Edge Cache: 24h&#xa;10GB転送/月&#xa;$2.05/月" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10" vertex="1" parent="1">
          <mxGeometry x="540" y="263" width="158" height="85" as="geometry" />
        </mxCell>

        <!-- ACM -->
        <mxCell id="acm" value="" style="sketch=0;outlineConnect=0;fontColor=#232F3E;gradientColor=none;fillColor=#DD344C;strokeColor=none;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=12;fontStyle=0;aspect=fixed;pointerEvents=1;shape=mxgraph.aws4.certificate_manager_3;" vertex="1" parent="1">
          <mxGeometry x="760" y="180" width="78" height="78" as="geometry" />
        </mxCell>
        <mxCell id="acm-label" value="ACM Certificate&#xa;*.company.com&#xa;無料" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=11" vertex="1" parent="1">
          <mxGeometry x="730" y="263" width="138" height="50" as="geometry" />
        </mxCell>

        <!-- S3 Frontend -->
        <mxCell id="s3-frontend" value="" style="sketch=0;outlineConnect=0;fontColor=#232F3E;gradientColor=none;fillColor=#7AA116;strokeColor=none;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=12;fontStyle=0;aspect=fixed;pointerEvents=1;shape=mxgraph.aws4.s3_bucket;" vertex="1" parent="1">
          <mxGeometry x="580" y="380" width="78" height="81" as="geometry" />
        </mxCell>
        <mxCell id="s3-frontend-label" value="S3 Frontend Bucket&#xa;cis-filesearch-frontend-prod&#xa;Next.js Static: 50MB&#xa;OAC&#xa;$0.01/月" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10" vertex="1" parent="1">
          <mxGeometry x="540" y="465" width="158" height="70" as="geometry" />
        </mxCell>

        <!-- Authentication Layer -->
        <mxCell id="auth-container" value="認証・認可層" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#F3E5F5;strokeColor=#4A148C;verticalAlign=top;fontSize=14;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="1040" y="140" width="480" height="380" as="geometry" />
        </mxCell>

        <!-- Cognito User Pool -->
        <mxCell id="cognito-userpool" value="" style="sketch=0;outlineConnect=0;fontColor=#232F3E;gradientColor=none;fillColor=#DD344C;strokeColor=none;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=12;fontStyle=0;aspect=fixed;pointerEvents=1;shape=mxgraph.aws4.cognito;" vertex="1" parent="1">
          <mxGeometry x="1100" y="180" width="78" height="78" as="geometry" />
        </mxCell>
        <mxCell id="cognito-label" value="Cognito User Pool&#xa;cis-filesearch-users&#xa;50名&#xa;MFA: OPTIONAL&#xa;$2.50/月" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10" vertex="1" parent="1">
          <mxGeometry x="1060" y="263" width="158" height="75" as="geometry" />
        </mxCell>

        <!-- Hosted UI -->
        <mxCell id="hosted-ui" value="Cognito Hosted UI" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#F3E5F5;strokeColor=#4A148C;fontSize=12;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="1280" y="180" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="hosted-ui-label" value="OAuth 2.0 PKCE&#xa;cis-filesearch.auth&#xa;.ap-northeast-1&#xa;.amazoncognito.com" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=9" vertex="1" parent="1">
          <mxGeometry x="1260" y="245" width="240" height="60" as="geometry" />
        </mxCell>

        <!-- Identity Pool -->
        <mxCell id="identity-pool" value="Identity Pool" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#F3E5F5;strokeColor=#4A148C;fontSize=12;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="1280" y="340" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="identity-pool-label" value="IAM Roles&#xa;S3/API Access" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10" vertex="1" parent="1">
          <mxGeometry x="1280" y="405" width="200" height="40" as="geometry" />
        </mxCell>

        <!-- On-Premise Infrastructure -->
        <mxCell id="onprem-container" value="オンプレミス環境" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#F5F5F5;strokeColor=#CCCCCC;verticalAlign=top;fontSize=14;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="80" y="580" width="440" height="380" as="geometry" />
        </mxCell>

        <!-- NAS Server -->
        <mxCell id="nas-server" value="" style="sketch=0;outlineConnect=0;fontColor=#232F3E;gradientColor=none;fillColor=#232F3D;strokeColor=none;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=12;fontStyle=0;aspect=fixed;pointerEvents=1;shape=mxgraph.aws4.traditional_server;" vertex="1" parent="1">
          <mxGeometry x="140" y="640" width="78" height="78" as="geometry" />
        </mxCell>
        <mxCell id="nas-label" value="NAS Server&#xa;SMB/NFS&#xa;500GB&#xa;1,000,000 files" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=11" vertex="1" parent="1">
          <mxGeometry x="110" y="723" width="138" height="60" as="geometry" />
        </mxCell>

        <!-- DataSync Agent -->
        <mxCell id="datasync-agent" value="DataSync Agent" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#F5F5F5;strokeColor=#CCCCCC;fontSize=12;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="160" y="820" width="180" height="50" as="geometry" />
        </mxCell>
        <mxCell id="datasync-agent-label" value="増分検出エージェント&#xa;version: 1.0.52" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10" vertex="1" parent="1">
          <mxGeometry x="140" y="875" width="220" height="35" as="geometry" />
        </mxCell>

        <!-- VPN Router -->
        <mxCell id="vpn-router" value="VPN Router" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#F5F5F5;strokeColor=#CCCCCC;fontSize=12;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="360" y="820" width="140" height="50" as="geometry" />
        </mxCell>
        <mxCell id="vpn-router-label" value="Customer Gateway&#xa;Cisco ASA 5506" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10" vertex="1" parent="1">
          <mxGeometry x="340" y="875" width="180" height="35" as="geometry" />
        </mxCell>

        <!-- AWS Cloud Container -->
        <mxCell id="aws-container" value="AWS Cloud (ap-northeast-1)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFF7E6;strokeColor=#FF9800;verticalAlign=top;fontSize=16;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="600" y="580" width="2500" height="1700" as="geometry" />
        </mxCell>

        <!-- VPC Container -->
        <mxCell id="vpc-container" value="VPC: 10.0.0.0/16" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E8F4F8;strokeColor=#0277BD;verticalAlign=top;fontSize=14;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="640" y="640" width="1600" height="1200" as="geometry" />
        </mxCell>

        <!-- Internet Gateway -->
        <mxCell id="igw" value="Internet Gateway" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#BBDEFB;strokeColor=#1976D2;fontSize=12;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="740" y="680" width="160" height="50" as="geometry" />
        </mxCell>
        <mxCell id="igw-label" value="インターネット接続" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10" vertex="1" parent="1">
          <mxGeometry x="740" y="735" width="160" height="25" as="geometry" />
        </mxCell>

        <!-- Virtual Private Gateway -->
        <mxCell id="vpg" value="" style="sketch=0;outlineConnect=0;fontColor=#232F3E;gradientColor=none;fillColor=#8C4FFF;strokeColor=none;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=12;fontStyle=0;aspect=fixed;pointerEvents=1;shape=mxgraph.aws4.vpn_gateway;" vertex="1" parent="1">
          <mxGeometry x="980" y="680" width="78" height="78" as="geometry" />
        </mxCell>
        <mxCell id="vpg-label" value="Virtual Private Gateway&#xa;Site-to-Site VPN&#xa;月4時間のみ接続&#xa;2:00-6:00 (月1日)" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10" vertex="1" parent="1">
          <mxGeometry x="940" y="763" width="158" height="65" as="geometry" />
        </mxCell>

        <!-- Public Subnet -->
        <mxCell id="public-subnet" value="Public Subnet: 10.0.0.0/24 (AZ-a)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#BBDEFB;strokeColor=#1976D2;verticalAlign=top;fontSize=13;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="720" y="880" width="480" height="180" as="geometry" />
        </mxCell>

        <!-- NAT Gateway -->
        <mxCell id="nat-gateway" value="NAT Gateway" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#BBDEFB;strokeColor=#1976D2;fontSize=12;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="840" y="930" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="nat-label" value="Elastic IP&#xa;インターネット経由&#xa;アクセス制御" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10" vertex="1" parent="1">
          <mxGeometry x="820" y="995" width="240" height="50" as="geometry" />
        </mxCell>

        <!-- Private Subnet 1 -->
        <mxCell id="private-subnet1" value="Private Subnet 1: 10.0.1.0/24 (AZ-a)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FCE4EC;strokeColor=#C2185B;verticalAlign=top;fontSize=13;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="720" y="1100" width="720" height="680" as="geometry" />
        </mxCell>

        <!-- VPNManager Lambda -->
        <mxCell id="vpnmanager" value="" style="sketch=0;outlineConnect=0;fontColor=#232F3E;gradientColor=none;fillColor=#ED7100;strokeColor=none;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=12;fontStyle=0;aspect=fixed;pointerEvents=1;shape=mxgraph.aws4.lambda_function;" vertex="1" parent="1">
          <mxGeometry x="780" y="1160" width="78" height="78" as="geometry" />
        </mxCell>
        <mxCell id="vpnmanager-label" value="VPNManager&#xa;Python 3.11&#xa;512MB ARM64&#xa;VPN接続制御" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10" vertex="1" parent="1">
          <mxGeometry x="750" y="1243" width="138" height="60" as="geometry" />
        </mxCell>

        <!-- FileScanner Lambda -->
        <mxCell id="filescanner" value="" style="sketch=0;outlineConnect=0;fontColor=#232F3E;gradientColor=none;fillColor=#ED7100;strokeColor=none;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=12;fontStyle=0;aspect=fixed;pointerEvents=1;shape=mxgraph.aws4.lambda_function;" vertex="1" parent="1">
          <mxGeometry x="980" y="1160" width="78" height="78" as="geometry" />
        </mxCell>
        <mxCell id="filescanner-label" value="FileScanner&#xa;Node.js 20&#xa;1024MB ARM64&#xa;S3全スキャン" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10" vertex="1" parent="1">
          <mxGeometry x="950" y="1243" width="138" height="60" as="geometry" />
        </mxCell>

        <!-- TextExtractor Lambda -->
        <mxCell id="textextractor" value="" style="sketch=0;outlineConnect=0;fontColor=#232F3E;gradientColor=none;fillColor=#ED7100;strokeColor=none;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=12;fontStyle=0;aspect=fixed;pointerEvents=1;shape=mxgraph.aws4.lambda_function;" vertex="1" parent="1">
          <mxGeometry x="780" y="1360" width="78" height="78" as="geometry" />
        </mxCell>
        <mxCell id="textextractor-label" value="TextExtractor&#xa;Python 3.11&#xa;2048MB ARM64&#xa;PDF解析" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10" vertex="1" parent="1">
          <mxGeometry x="750" y="1443" width="138" height="60" as="geometry" />
        </mxCell>

        <!-- ImageExtractor Lambda -->
        <mxCell id="imageextractor" value="" style="sketch=0;outlineConnect=0;fontColor=#232F3E;gradientColor=none;fillColor=#ED7100;strokeColor=none;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=12;fontStyle=0;aspect=fixed;pointerEvents=1;shape=mxgraph.aws4.lambda_function;" vertex="1" parent="1">
          <mxGeometry x="980" y="1360" width="78" height="78" as="geometry" />
        </mxCell>
        <mxCell id="imageextractor-label" value="ImageFeatureExtractor&#xa;Python 3.11&#xa;2048MB ARM64&#xa;ResNet-50" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10" vertex="1" parent="1">
          <mxGeometry x="950" y="1443" width="158" height="60" as="geometry" />
        </mxCell>

        <!-- BulkIndexer Lambda -->
        <mxCell id="bulkindexer" value="" style="sketch=0;outlineConnect=0;fontColor=#232F3E;gradientColor=none;fillColor=#ED7100;strokeColor=none;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=12;fontStyle=0;aspect=fixed;pointerEvents=1;shape=mxgraph.aws4.lambda_function;" vertex="1" parent="1">
          <mxGeometry x="1180" y="1360" width="78" height="78" as="geometry" />
        </mxCell>
        <mxCell id="bulkindexer-label" value="BulkIndexer&#xa;Node.js 20&#xa;1024MB ARM64&#xa;Bulk API" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10" vertex="1" parent="1">
          <mxGeometry x="1150" y="1443" width="138" height="60" as="geometry" />
        </mxCell>

        <!-- OpenSearch -->
        <mxCell id="opensearch" value="" style="sketch=0;outlineConnect=0;fontColor=#232F3E;gradientColor=none;fillColor=#8C4FFF;strokeColor=none;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=12;fontStyle=0;aspect=fixed;pointerEvents=1;shape=mxgraph.aws4.opensearch_service;" vertex="1" parent="1">
          <mxGeometry x="780" y="1580" width="78" height="78" as="geometry" />
        </mxCell>
        <mxCell id="opensearch-label" value="OpenSearch Service&#xa;t3.small.search&#xa;vCPU: 2, RAM: 2GB&#xa;50GB gp3&#xa;kuromoji, k-NN&#xa;$31.57/月" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10" vertex="1" parent="1">
          <mxGeometry x="740" y="1663" width="158" height="95" as="geometry" />
        </mxCell>

        <!-- Private Subnet 2 -->
        <mxCell id="private-subnet2" value="Private Subnet 2: 10.0.2.0/24 (AZ-b)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FCE4EC;strokeColor=#C2185B;verticalAlign=top;fontSize=13;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="1500" y="1100" width="680" height="280" as="geometry" />
        </mxCell>

        <!-- SearchAPI Lambda -->
        <mxCell id="searchapi" value="" style="sketch=0;outlineConnect=0;fontColor=#232F3E;gradientColor=none;fillColor=#ED7100;strokeColor=none;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=12;fontStyle=0;aspect=fixed;pointerEvents=1;shape=mxgraph.aws4.lambda_function;" vertex="1" parent="1">
          <mxGeometry x="1801" y="1180" width="78" height="78" as="geometry" />
        </mxCell>
        <mxCell id="searchapi-label" value="SearchAPI&#xa;Node.js 20&#xa;512MB ARM64&#xa;POST /api/search&#xa;Multi-AZ冗長性&#xa;Cognito JWT検証" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10" vertex="1" parent="1">
          <mxGeometry x="1760" y="1263" width="160" height="90" as="geometry" />
        </mxCell>

        <!-- API Gateway -->
        <mxCell id="apigw" value="" style="sketch=0;outlineConnect=0;fontColor=#232F3E;gradientColor=none;fillColor=#8C4FFF;strokeColor=none;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=12;fontStyle=0;aspect=fixed;pointerEvents=1;shape=mxgraph.aws4.api_gateway;" vertex="1" parent="1">
          <mxGeometry x="1801" y="880" width="78" height="78" as="geometry" />
        </mxCell>
        <mxCell id="apigw-label" value="API Gateway&#xa;api.filesearch.company.com&#xa;Cognito Authorizer&#xa;Custom Domain&#xa;Throttling: 100req/s&#xa;$0.20/月" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10" vertex="1" parent="1">
          <mxGeometry x="1750" y="963" width="180" height="95" as="geometry" />
        </mxCell>

        <!-- Managed Services (Outside VPC) -->
        <mxCell id="managed-container" value="マネージドサービス層（VPC外）" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFF9C4;strokeColor=#F57F17;verticalAlign=top;fontSize=14;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="2320" y="640" width="720" height="580" as="geometry" />
        </mxCell>

        <!-- DataSync -->
        <mxCell id="datasync" value="" style="sketch=0;outlineConnect=0;fontColor=#232F3E;gradientColor=none;fillColor=#8C4FFF;strokeColor=none;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=12;fontStyle=0;aspect=fixed;pointerEvents=1;shape=mxgraph.aws4.datasync;" vertex="1" parent="1">
          <mxGeometry x="2380" y="700" width="78" height="78" as="geometry" />
        </mxCell>
        <mxCell id="datasync-label" value="AWS DataSync&#xa;増分同期: 20GB/月&#xa;転送レート: 100Mbps&#xa;$5.00/月" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10" vertex="1" parent="1">
          <mxGeometry x="2340" y="783" width="158" height="65" as="geometry" />
        </mxCell>

        <!-- S3 Backend -->
        <mxCell id="s3-backend" value="" style="sketch=0;outlineConnect=0;fontColor=#232F3E;gradientColor=none;fillColor=#7AA116;strokeColor=none;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=12;fontStyle=0;aspect=fixed;pointerEvents=1;shape=mxgraph.aws4.s3_bucket;" vertex="1" parent="1">
          <mxGeometry x="2620" y="700" width="78" height="81" as="geometry" />
        </mxCell>
        <mxCell id="s3-backend-label" value="S3 Backend Bucket&#xa;Intelligent-Tiering&#xa;100GB&#xa;抽出テキスト: 40GB&#xa;画像特徴量: 10GB&#xa;$2.13/月" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10" vertex="1" parent="1">
          <mxGeometry x="2580" y="786" width="158" height="95" as="geometry" />
        </mxCell>

        <!-- DynamoDB -->
        <mxCell id="dynamodb" value="" style="sketch=0;outlineConnect=0;fontColor=#232F3E;gradientColor=none;fillColor=#4D27AA;strokeColor=none;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=12;fontStyle=0;aspect=fixed;pointerEvents=1;shape=mxgraph.aws4.dynamodb;" vertex="1" parent="1">
          <mxGeometry x="2860" y="700" width="78" height="78" as="geometry" />
        </mxCell>
        <mxCell id="dynamodb-label" value="DynamoDB&#xa;On-Demand&#xa;file_metadata: 5GB&#xa;sync_jobs: 100MB&#xa;$0.99/月" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10" vertex="1" parent="1">
          <mxGeometry x="2820" y="783" width="158" height="80" as="geometry" />
        </mxCell>

        <!-- Orchestration Layer -->
        <mxCell id="orchestration-container" value="オーケストレーション層" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFF9C4;strokeColor=#F57F17;verticalAlign=top;fontSize=14;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="2320" y="1280" width="720" height="380" as="geometry" />
        </mxCell>

        <!-- Step Functions -->
        <mxCell id="stepfunctions" value="" style="sketch=0;outlineConnect=0;fontColor=#232F3E;gradientColor=none;fillColor=#E7157B;strokeColor=none;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=12;fontStyle=0;aspect=fixed;pointerEvents=1;shape=mxgraph.aws4.step_functions;" vertex="1" parent="1">
          <mxGeometry x="2380" y="1340" width="78" height="78" as="geometry" />
        </mxCell>
        <mxCell id="stepfunctions-label" value="Step Functions&#xa;MonthlyBatchSync&#xa;実行頻度: 月1回&#xa;実行時間: 5-6時間" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10" vertex="1" parent="1">
          <mxGeometry x="2340" y="1423" width="158" height="65" as="geometry" />
        </mxCell>

        <!-- EventBridge -->
        <mxCell id="eventbridge" value="" style="sketch=0;outlineConnect=0;fontColor=#232F3E;gradientColor=none;fillColor=#E7157B;strokeColor=none;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=12;fontStyle=0;aspect=fixed;pointerEvents=1;shape=mxgraph.aws4.eventbridge;" vertex="1" parent="1">
          <mxGeometry x="2620" y="1340" width="78" height="78" as="geometry" />
        </mxCell>
        <mxCell id="eventbridge-label" value="EventBridge&#xa;cron(0 2 1 * ? *)&#xa;毎月1日 深夜2時" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10" vertex="1" parent="1">
          <mxGeometry x="2580" y="1423" width="158" height="50" as="geometry" />
        </mxCell>

        <!-- SNS -->
        <mxCell id="sns" value="" style="sketch=0;outlineConnect=0;fontColor=#232F3E;gradientColor=none;fillColor=#E7157B;strokeColor=none;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=12;fontStyle=0;aspect=fixed;pointerEvents=1;shape=mxgraph.aws4.sns;" vertex="1" parent="1">
          <mxGeometry x="2860" y="1340" width="78" height="78" as="geometry" />
        </mxCell>
        <mxCell id="sns-label" value="SNS&#xa;BatchNotifications&#xa;管理者メール × 5" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10" vertex="1" parent="1">
          <mxGeometry x="2820" y="1423" width="158" height="50" as="geometry" />
        </mxCell>

        <!-- CloudWatch -->
        <mxCell id="cloudwatch" value="" style="sketch=0;outlineConnect=0;fontColor=#232F3E;gradientColor=none;fillColor=#E7157B;strokeColor=none;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=12;fontStyle=0;aspect=fixed;pointerEvents=1;shape=mxgraph.aws4.cloudwatch;" vertex="1" parent="1">
          <mxGeometry x="2620" y="1540" width="78" height="78" as="geometry" />
        </mxCell>
        <mxCell id="cloudwatch-label" value="CloudWatch&#xa;Logs: 2GB/月&#xa;Metrics: 10個&#xa;Alarms: 5個&#xa;$4.00/月" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10" vertex="1" parent="1">
          <mxGeometry x="2580" y="1623" width="158" height="75" as="geometry" />
        </mxCell>

        <!-- Authentication Flow (Purple) -->
        <mxCell id="auth-flow-1" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#9C27B0;strokeWidth=3;endArrow=classic;endFill=1;" edge="1" parent="1" source="user-icon" target="route53">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="auth-flow-1-label" value="① HTTPS&#xa;filesearch.company.com" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=10;fontColor=#9C27B0;fontStyle=1" vertex="1" connectable="0" parent="auth-flow-1">
          <mxGeometry x="-0.2" y="2" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>

        <mxCell id="auth-flow-2" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#9C27B0;strokeWidth=3;endArrow=classic;endFill=1;" edge="1" parent="1" source="route53" target="cloudfront">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="auth-flow-2-label" value="② DNS解決" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=10;fontColor=#9C27B0;fontStyle=1" vertex="1" connectable="0" parent="auth-flow-2">
          <mxGeometry x="-0.2" y="2" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>

        <mxCell id="auth-flow-3" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#9C27B0;strokeWidth=2;endArrow=classic;endFill=1;" edge="1" parent="1" source="cloudfront" target="acm">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="auth-flow-3-label" value="③ TLS 1.3検証" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=10;fontColor=#9C27B0;fontStyle=1" vertex="1" connectable="0" parent="auth-flow-3">
          <mxGeometry x="-0.2" y="2" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>

        <mxCell id="auth-flow-4" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#9C27B0;strokeWidth=3;endArrow=classic;endFill=1;startArrow=classic;startFill=1;" edge="1" parent="1" source="cloudfront" target="s3-frontend">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="auth-flow-4-label" value="④ 静的コンテンツ配信&#xa;Next.js Static Export" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=10;fontColor=#9C27B0;fontStyle=1" vertex="1" connectable="0" parent="auth-flow-4">
          <mxGeometry x="-0.2" y="2" relative="1" as="geometry">
            <mxPoint x="60" as="offset" />
          </mxGeometry>
        </mxCell>

        <mxCell id="auth-flow-5" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#9C27B0;strokeWidth=2;dashed=1;endArrow=classic;endFill=1;startArrow=classic;startFill=1;" edge="1" parent="1" source="user-icon" target="hosted-ui">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="179" y="120" />
              <mxPoint x="1380" y="120" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="auth-flow-5-label" value="⑤ 未認証時&#xa;Redirect to Login" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=10;fontColor=#9C27B0;fontStyle=1" vertex="1" connectable="0" parent="auth-flow-5">
          <mxGeometry x="-0.2" y="2" relative="1" as="geometry">
            <mxPoint y="-10" as="offset" />
          </mxGeometry>
        </mxCell>

        <mxCell id="auth-flow-6" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#9C27B0;strokeWidth=3;endArrow=classic;endFill=1;" edge="1" parent="1" source="hosted-ui" target="cognito-userpool">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="auth-flow-6-label" value="⑥ 認証&#xa;(username+password)&#xa;+ MFA" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=10;fontColor=#9C27B0;fontStyle=1" vertex="1" connectable="0" parent="auth-flow-6">
          <mxGeometry x="-0.2" y="2" relative="1" as="geometry">
            <mxPoint y="20" as="offset" />
          </mxGeometry>
        </mxCell>

        <mxCell id="auth-flow-10" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#9C27B0;strokeWidth=3;endArrow=classic;endFill=1;startArrow=classic;startFill=1;" edge="1" parent="1" source="user-icon" target="cognito-userpool">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="179" y="100" />
              <mxPoint x="1139" y="100" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="auth-flow-10-label" value="⑨ POST /oauth2/token&#xa;⑩ JWT Tokens" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=10;fontColor=#9C27B0;fontStyle=1" vertex="1" connectable="0" parent="auth-flow-10">
          <mxGeometry x="-0.2" y="2" relative="1" as="geometry">
            <mxPoint y="-10" as="offset" />
          </mxGeometry>
        </mxCell>

        <!-- Search Flow (Green) -->
        <mxCell id="search-flow-1" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#00AA00;strokeWidth=3;endArrow=classic;endFill=1;" edge="1" parent="1" source="user-icon" target="apigw">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="300" y="219" />
              <mxPoint x="300" y="560" />
              <mxPoint x="1840" y="560" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="search-flow-1-label" value="⑪ POST /api/search&#xa;Authorization: Bearer {token}" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=10;fontColor=#00AA00;fontStyle=1" vertex="1" connectable="0" parent="search-flow-1">
          <mxGeometry x="-0.2" y="2" relative="1" as="geometry">
            <mxPoint x="420" y="-10" as="offset" />
          </mxGeometry>
        </mxCell>

        <mxCell id="search-flow-2" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#00AA00;strokeWidth=3;endArrow=classic;endFill=1;startArrow=classic;startFill=1;" edge="1" parent="1" source="apigw" target="cognito-userpool">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1840" y="820" />
              <mxPoint x="1139" y="820" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="search-flow-2-label" value="⑬ JWT検証&#xa;⑭ 認可OK" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=10;fontColor=#00AA00;fontStyle=1" vertex="1" connectable="0" parent="search-flow-2">
          <mxGeometry x="-0.2" y="2" relative="1" as="geometry">
            <mxPoint x="-180" y="-10" as="offset" />
          </mxGeometry>
        </mxCell>

        <mxCell id="search-flow-3" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#00AA00;strokeWidth=3;endArrow=classic;endFill=1;" edge="1" parent="1" source="apigw" target="searchapi">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="search-flow-3-label" value="⑮ Invoke" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=10;fontColor=#00AA00;fontStyle=1" vertex="1" connectable="0" parent="search-flow-3">
          <mxGeometry x="-0.2" y="2" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>

        <mxCell id="search-flow-4" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#00AA00;strokeWidth=2;endArrow=classic;endFill=1;startArrow=classic;startFill=1;" edge="1" parent="1" source="searchapi" target="opensearch">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1840" y="1460" />
              <mxPoint x="1380" y="1460" />
              <mxPoint x="1380" y="1619" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="search-flow-4-label" value="⑯ 全文検索" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=10;fontColor=#00AA00;fontStyle=1" vertex="1" connectable="0" parent="search-flow-4">
          <mxGeometry x="-0.2" y="2" relative="1" as="geometry">
            <mxPoint x="-180" as="offset" />
          </mxGeometry>
        </mxCell>

        <mxCell id="search-flow-5" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#00AA00;strokeWidth=2;endArrow=classic;endFill=1;startArrow=classic;startFill=1;" edge="1" parent="1" source="searchapi" target="dynamodb">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1840" y="1500" />
              <mxPoint x="2899" y="1500" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="search-flow-5-label" value="⑰ GetItem" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=10;fontColor=#00AA00;fontStyle=1" vertex="1" connectable="0" parent="search-flow-5">
          <mxGeometry x="-0.2" y="2" relative="1" as="geometry">
            <mxPoint x="280" as="offset" />
          </mxGeometry>
        </mxCell>

        <!-- Batch Synchronization Flow (Blue) -->
        <mxCell id="batch-flow-1" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#0066CC;strokeWidth=3;endArrow=classic;endFill=1;" edge="1" parent="1" source="eventbridge" target="stepfunctions">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="batch-flow-1-label" value="⑳ 月1回トリガー" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=10;fontColor=#0066CC;fontStyle=1" vertex="1" connectable="0" parent="batch-flow-1">
          <mxGeometry x="-0.2" y="2" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>

        <mxCell id="batch-flow-2" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#0066CC;strokeWidth=3;endArrow=classic;endFill=1;" edge="1" parent="1" source="stepfunctions" target="vpnmanager">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="2080" y="1379" />
              <mxPoint x="2080" y="1199" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="batch-flow-2-label" value="㉑ VPN接続開始" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=10;fontColor=#0066CC;fontStyle=1" vertex="1" connectable="0" parent="batch-flow-2">
          <mxGeometry x="-0.2" y="2" relative="1" as="geometry">
            <mxPoint x="-360" as="offset" />
          </mxGeometry>
        </mxCell>

        <mxCell id="batch-flow-3" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#0066CC;strokeWidth=2;dashed=1;endArrow=classic;endFill=1;" edge="1" parent="1" source="vpnmanager" target="vpg">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="819" y="1080" />
              <mxPoint x="1019" y="1080" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="batch-flow-3-label" value="㉒ VPN接続確立" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=10;fontColor=#0066CC;fontStyle=1" vertex="1" connectable="0" parent="batch-flow-3">
          <mxGeometry x="-0.2" y="2" relative="1" as="geometry">
            <mxPoint y="-10" as="offset" />
          </mxGeometry>
        </mxCell>

        <mxCell id="batch-flow-4" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#0066CC;strokeWidth=3;endArrow=classic;endFill=1;" edge="1" parent="1" source="vpnmanager" target="datasync">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="819" y="1060" />
              <mxPoint x="2419" y="1060" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="batch-flow-4-label" value="㉓ DataSync起動" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=10;fontColor=#0066CC;fontStyle=1" vertex="1" connectable="0" parent="batch-flow-4">
          <mxGeometry x="-0.2" y="2" relative="1" as="geometry">
            <mxPoint x="420" y="-10" as="offset" />
          </mxGeometry>
        </mxCell>

        <!-- Data Transfer Flow (Orange) -->
        <mxCell id="transfer-flow-1" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#FF9900;strokeWidth=4;endArrow=classic;endFill=1;" edge="1" parent="1" source="vpn-router" target="vpg">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="540" y="845" />
              <mxPoint x="540" y="840" />
              <mxPoint x="1019" y="840" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="transfer-flow-1-label" value="㉔ 増分データ転送&#xa;20GB/月, 3時間" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=10;fontColor=#FF9900;fontStyle=1" vertex="1" connectable="0" parent="transfer-flow-1">
          <mxGeometry x="-0.2" y="2" relative="1" as="geometry">
            <mxPoint x="60" y="-10" as="offset" />
          </mxGeometry>
        </mxCell>

        <mxCell id="transfer-flow-2" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#FF9900;strokeWidth=4;endArrow=classic;endFill=1;" edge="1" parent="1" source="vpg" target="datasync">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1140" y="719" />
              <mxPoint x="1140" y="620" />
              <mxPoint x="2419" y="620" />
            </Array>
          </mxGeometry>
        </mxCell>

        <mxCell id="transfer-flow-3" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#FF9900;strokeWidth=4;endArrow=classic;endFill=1;" edge="1" parent="1" source="datasync" target="s3-backend">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="batch-flow-5" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#0066CC;strokeWidth=3;endArrow=classic;endFill=1;" edge="1" parent="1" source="stepfunctions" target="filescanner">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="2100" y="1379" />
              <mxPoint x="2100" y="1199" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="batch-flow-5-label" value="㉖ S3スキャン開始" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=10;fontColor=#0066CC;fontStyle=1" vertex="1" connectable="0" parent="batch-flow-5">
          <mxGeometry x="-0.2" y="2" relative="1" as="geometry">
            <mxPoint x="-340" as="offset" />
          </mxGeometry>
        </mxCell>

        <mxCell id="batch-flow-6" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#0066CC;strokeWidth=3;endArrow=classic;endFill=1;" edge="1" parent="1" source="filescanner" target="textextractor">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="batch-flow-6-label" value="㉘ テキスト抽出&#xa;5,000 PDFs" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=10;fontColor=#0066CC;fontStyle=1" vertex="1" connectable="0" parent="batch-flow-6">
          <mxGeometry x="-0.2" y="2" relative="1" as="geometry">
            <mxPoint x="-50" as="offset" />
          </mxGeometry>
        </mxCell>

        <mxCell id="batch-flow-7" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#0066CC;strokeWidth=3;endArrow=classic;endFill=1;" edge="1" parent="1" source="filescanner" target="imageextractor">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1019" y="1280" />
              <mxPoint x="1019" y="1280" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="batch-flow-7-label" value="㉘ 画像特徴抽出&#xa;2,000 Images" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=10;fontColor=#0066CC;fontStyle=1" vertex="1" connectable="0" parent="batch-flow-7">
          <mxGeometry x="-0.2" y="2" relative="1" as="geometry">
            <mxPoint x="60" y="-10" as="offset" />
          </mxGeometry>
        </mxCell>

        <mxCell id="batch-flow-8" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#0066CC;strokeWidth=3;endArrow=classic;endFill=1;" edge="1" parent="1" source="textextractor" target="bulkindexer">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="819" y="1520" />
              <mxPoint x="1219" y="1520" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="batch-flow-8-label" value="㉚ 処理完了通知" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=10;fontColor=#0066CC;fontStyle=1" vertex="1" connectable="0" parent="batch-flow-8">
          <mxGeometry x="-0.2" y="2" relative="1" as="geometry">
            <mxPoint x="60" y="-10" as="offset" />
          </mxGeometry>
        </mxCell>

        <mxCell id="batch-flow-9" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#0066CC;strokeWidth=3;endArrow=classic;endFill=1;" edge="1" parent="1" source="imageextractor" target="bulkindexer">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="batch-flow-10" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#0066CC;strokeWidth=3;endArrow=classic;endFill=1;" edge="1" parent="1" source="bulkindexer" target="opensearch">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1219" y="1619" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="batch-flow-10-label" value="㉜ Bulk API&#xa;kuromoji + k-NN" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=10;fontColor=#0066CC;fontStyle=1" vertex="1" connectable="0" parent="batch-flow-10">
          <mxGeometry x="-0.2" y="2" relative="1" as="geometry">
            <mxPoint x="-100" as="offset" />
          </mxGeometry>
        </mxCell>

        <mxCell id="batch-flow-11" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#0066CC;strokeWidth=3;endArrow=classic;endFill=1;" edge="1" parent="1" source="bulkindexer" target="dynamodb">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1219" y="1540" />
              <mxPoint x="2899" y="1540" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="batch-flow-11-label" value="㉝ メタデータ更新" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=10;fontColor=#0066CC;fontStyle=1" vertex="1" connectable="0" parent="batch-flow-11">
          <mxGeometry x="-0.2" y="2" relative="1" as="geometry">
            <mxPoint x="460" as="offset" />
          </mxGeometry>
        </mxCell>

        <mxCell id="batch-flow-12" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#0066CC;strokeWidth=3;endArrow=classic;endFill=1;" edge="1" parent="1" source="bulkindexer" target="sns">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1219" y="1560" />
              <mxPoint x="2899" y="1560" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="batch-flow-12-label" value="㉞ 完了通知" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=10;fontColor=#0066CC;fontStyle=1" vertex="1" connectable="0" parent="batch-flow-12">
          <mxGeometry x="-0.2" y="2" relative="1" as="geometry">
            <mxPoint x="500" as="offset" />
          </mxGeometry>
        </mxCell>

        <!-- Monitoring Flow (Cyan Dotted) -->
        <mxCell id="monitor-flow-1" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#00BCD4;strokeWidth=1;dashed=1;dashPattern=1 4;endArrow=classic;endFill=1;" edge="1" parent="1" source="vpnmanager" target="cloudwatch">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="819" y="1580" />
              <mxPoint x="2120" y="1580" />
              <mxPoint x="2120" y="1579" />
            </Array>
          </mxGeometry>
        </mxCell>

        <mxCell id="monitor-flow-2" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#00BCD4;strokeWidth=1;dashed=1;dashPattern=1 4;endArrow=classic;endFill=1;" edge="1" parent="1" source="filescanner" target="cloudwatch">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1019" y="1600" />
              <mxPoint x="2140" y="1600" />
              <mxPoint x="2140" y="1579" />
            </Array>
          </mxGeometry>
        </mxCell>

        <mxCell id="monitor-flow-3" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#00BCD4;strokeWidth=1;dashed=1;dashPattern=1 4;endArrow=classic;endFill=1;" edge="1" parent="1" source="searchapi" target="cloudwatch">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1840" y="1540" />
              <mxPoint x="2180" y="1540" />
              <mxPoint x="2180" y="1579" />
            </Array>
          </mxGeometry>
        </mxCell>

        <mxCell id="monitor-flow-4" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#00BCD4;strokeWidth=1;dashed=1;dashPattern=1 4;endArrow=classic;endFill=1;" edge="1" parent="1" source="cloudfront" target="cloudwatch">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="619" y="540" />
              <mxPoint x="2200" y="540" />
              <mxPoint x="2200" y="1579" />
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- Cost Breakdown Table -->
        <mxCell id="cost-table" value="コスト構成 ($51.79/月)&#xa;• OpenSearch: $31.57 (61.0%)&#xa;• DataSync: $5.00 (9.7%)&#xa;• CloudWatch: $4.00 (7.7%)&#xa;• Cognito: $2.50 (4.8%)&#xa;• S3: $2.13 (4.1%)&#xa;• CloudFront: $2.05 (4.0%)&#xa;• Lambda: $1.35 (2.6%)&#xa;• その他: $4.19 (8.1%)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFF9C4;strokeColor=#F57F17;align=left;verticalAlign=top;fontSize=11;fontFamily=Courier New;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="2320" y="1940" width="320" height="200" as="geometry" />
        </mxCell>

        <!-- Key Features Box -->
        <mxCell id="features-box" value="主要な特徴&#xa;• 月1回の増分同期 (VPN: 月4時間)&#xa;• OAuth 2.0 PKCE認証&#xa;• CloudFront グローバル配信&#xa;• TLS 1.3暗号化&#xa;• Response: 50-150ms&#xa;• Availability: 99.99%" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E1F5FE;strokeColor=#01579B;align=left;verticalAlign=top;fontSize=11;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="80" y="1980" width="360" height="160" as="geometry" />
        </mxCell>

        <!-- Legend -->
        <mxCell id="legend-box" value="凡例" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#000000;align=left;verticalAlign=top;fontSize=12;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="2700" y="1940" width="340" height="200" as="geometry" />
        </mxCell>
        <mxCell id="legend-1" value="" style="edgeStyle=none;html=1;strokeColor=#9C27B0;strokeWidth=3;endArrow=classic;endFill=1;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="2730" y="1980" as="sourcePoint" />
            <mxPoint x="2780" y="1980" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="legend-1-text" value="認証フロー (OAuth 2.0 PKCE)" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10" vertex="1" parent="1">
          <mxGeometry x="2790" y="1970" width="240" height="20" as="geometry" />
        </mxCell>

        <mxCell id="legend-2" value="" style="edgeStyle=none;html=1;strokeColor=#00AA00;strokeWidth=3;endArrow=classic;endFill=1;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="2730" y="2010" as="sourcePoint" />
            <mxPoint x="2780" y="2010" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="legend-2-text" value="検索フロー (Cognito JWT)" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10" vertex="1" parent="1">
          <mxGeometry x="2790" y="2000" width="240" height="20" as="geometry" />
        </mxCell>

        <mxCell id="legend-3" value="" style="edgeStyle=none;html=1;strokeColor=#0066CC;strokeWidth=3;endArrow=classic;endFill=1;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="2730" y="2040" as="sourcePoint" />
            <mxPoint x="2780" y="2040" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="legend-3-text" value="バッチ同期フロー (月1回)" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10" vertex="1" parent="1">
          <mxGeometry x="2790" y="2030" width="240" height="20" as="geometry" />
        </mxCell>

        <mxCell id="legend-4" value="" style="edgeStyle=none;html=1;strokeColor=#FF9900;strokeWidth=4;endArrow=classic;endFill=1;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="2730" y="2070" as="sourcePoint" />
            <mxPoint x="2780" y="2070" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="legend-4-text" value="データ転送 (増分20GB)" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10" vertex="1" parent="1">
          <mxGeometry x="2790" y="2060" width="240" height="20" as="geometry" />
        </mxCell>

        <mxCell id="legend-5" value="" style="edgeStyle=none;html=1;strokeColor=#00BCD4;strokeWidth=1;dashed=1;dashPattern=1 4;endArrow=classic;endFill=1;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="2730" y="2100" as="sourcePoint" />
            <mxPoint x="2780" y="2100" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="legend-5-text" value="監視ログ" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10" vertex="1" parent="1">
          <mxGeometry x="2790" y="2090" width="240" height="20" as="geometry" />
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
# セキュリティチェックリスト

## 概要

CIS File Search Application の本番環境デプロイ前に確認すべき包括的なセキュリティチェックリストです。すべての項目にチェックを入れてから本番環境にデプロイしてください。

---

## 📋 デプロイ前セキュリティチェックリスト

### 1. 環境変数とシークレット管理

#### 必須項目

- [ ] `.env.local` ファイルが `.gitignore` に含まれている
- [ ] `.env.local` のファイルパーミッションが `600` または `400` に設定されている
- [ ] `.env.local.example` が存在し、実際の値が含まれていない
- [ ] 本番環境の環境変数がVercelまたはAWS Secrets Managerに安全に保存されている
- [ ] 開発環境と本番環境で異なる認証情報を使用している
- [ ] `NEXT_PUBLIC_` プレフィックスを持つ変数のみがブラウザに公開されている
- [ ] Client Secretが環境変数に含まれていない（PKCEの場合）

#### 推奨項目

- [ ] AWS Secrets Managerを使用して認証情報を管理している
- [ ] 認証情報のローテーション計画が策定されている（6ヶ月ごと）
- [ ] チーム内での認証情報共有方法が確立されている（暗号化または1Password）

---

### 2. AWS Cognito設定

#### User Pool設定

- [ ] パスワード最小文字数が14文字以上
- [ ] パスワード複雑性要件がすべて有効（大文字、小文字、数字、記号）
- [ ] 仮パスワードの有効期限が1日以内
- [ ] MFAが有効（OPTIONALまたはON）
- [ ] Advanced Security Modeが"ENFORCED"
- [ ] メール検証が必須（auto_verified_attributes = ["email"]）
- [ ] デバイストラッキングが有効

#### App Client設定

- [ ] Client Secretが生成されていない（`generate_secret = false`）
- [ ] OAuth Flowが"code"（Authorization Code with PKCE）
- [ ] Callback URLsが正しく設定されている
- [ ] Logout URLsが正しく設定されている
- [ ] Access Token有効期限が60分以下
- [ ] ID Token有効期限が60分以下
- [ ] Refresh Token有効期限が30日以下
- [ ] 不要な認証フロー（USER_PASSWORD_AUTH等）が無効
- [ ] `prevent_user_existence_errors` が"ENABLED"

#### セキュリティ機能

- [ ] Lambda Triggerでrate limitingが実装されている
- [ ] DynamoDB TTLでログイン試行履歴の自動削除が設定されている
- [ ] アカウントロックアウト機能が実装されている（5回失敗で15分ロック）
- [ ] 異常検知アラートが設定されている

---

### 3. CloudFront/CDNセキュリティ

#### セキュリティヘッダー

- [ ] `Strict-Transport-Security` ヘッダーが設定されている
- [ ] `Content-Security-Policy` ヘッダーが適切に設定されている
- [ ] `X-Content-Type-Options: nosniff` が設定されている
- [ ] `X-Frame-Options: DENY` が設定されている
- [ ] `X-XSS-Protection: 1; mode=block` が設定されている
- [ ] `Referrer-Policy: strict-origin-when-cross-origin` が設定されている
- [ ] `Permissions-Policy` が設定されている

#### SSL/TLS設定

- [ ] TLS 1.3が有効
- [ ] TLS 1.0/1.1が無効
- [ ] SSL証明書が有効（有効期限切れでない）
- [ ] HTTPS強制リダイレクトが設定されている

#### WAF設定

- [ ] AWS WAFが有効
- [ ] Rate Limitingルールが設定されている（例: 1000 req/5分）
- [ ] SQLインジェクション対策ルールが有効
- [ ] XSS対策ルールが有効
- [ ] 悪意のあるIPアドレスのブロックリストが設定されている

---

### 4. アプリケーションコード

#### 認証・認可

- [ ] すべてのAPI呼び出しで認証トークンを検証している
- [ ] JWTトークンの署名を検証している
- [ ] トークンの有効期限を確認している
- [ ] セッションタイムアウトが適切に設定されている（1時間）
- [ ] CSRF対策が実装されている
- [ ] CORS設定が適切（必要なオリジンのみ許可）

#### 入力検証

- [ ] すべてのユーザー入力が検証されている
- [ ] XSS対策のための出力エスケープが実装されている
- [ ] SQLインジェクション対策のためのパラメータ化クエリを使用している
- [ ] ファイルアップロードのバリデーションが実装されている
- [ ] 許可されたファイルタイプのみを受け入れている

#### データ保護

- [ ] 機密情報がログに出力されていない
- [ ] パスワードがbcryptでハッシュ化されている（Cognitoで自動）
- [ ] 個人情報がローカルストレージに平文で保存されていない
- [ ] API通信がHTTPSのみで行われている

---

### 5. インフラストラクチャ

#### AWS IAM

- [ ] 最小権限の原則に従っている
- [ ] Root アカウントが使用されていない
- [ ] MFAが有効（すべてのIAMユーザー）
- [ ] アクセスキーのローテーションが定期的に行われている（90日ごと）
- [ ] 不要なIAMユーザー/ロールが削除されている

#### ネットワーク

- [ ] VPC内のリソースにセキュリティグループが適切に設定されている
- [ ] 不要なポートが閉じられている
- [ ] パブリックアクセスが必要最小限に制限されている
- [ ] S3バケットがpublicに公開されていない

#### ログとモニタリング

- [ ] CloudWatchでログ収集が有効
- [ ] CloudTrailで監査ログが記録されている
- [ ] セキュリティイベントのアラートが設定されている
- [ ] ログ保持期間が適切に設定されている（最低90日）
- [ ] 定期的なログレビュープロセスが確立されている

---

### 6. コンプライアンス

#### GDPR準拠

- [ ] プライバシーポリシーが公開されている
- [ ] Cookie同意バナーが実装されている
- [ ] ユーザー同意の記録が保存されている
- [ ] データエクスポート機能が実装されている（Right to Access）
- [ ] アカウント削除機能が実装されている（Right to Erasure）
- [ ] データ処理台帳（ROPA）が作成されている
- [ ] データ保持期間が明示されている
- [ ] 72時間以内のデータ侵害通知プロセスが確立されている

#### CCPA準拠（該当する場合）

- [ ] プライバシーポリシーにCCPA要件が含まれている
- [ ] 「Do Not Sell My Personal Information」リンクが設置されている
- [ ] データカテゴリと使用目的が明示されている

#### 日本の個人情報保護法準拠

- [ ] 個人情報取扱いの通知が表示されている
- [ ] 利用目的が明示されている
- [ ] 第三者提供の有無が明示されている
- [ ] 安全管理措置が実施されている
- [ ] お問い合わせ窓口が設置されている

---

### 7. インシデント対応

#### 準備

- [ ] インシデント対応計画（IRP）が文書化されている
- [ ] インシデント対応チームが編成されている
- [ ] 緊急連絡先リストが最新
- [ ] インシデント報告フォームが準備されている

#### 検知

- [ ] セキュリティイベントの自動検知が設定されている
- [ ] CloudWatchアラームが適切に設定されている
- [ ] SNS通知が設定されている
- [ ] 24/7監視体制が確立されている（必要な場合）

#### 対応

- [ ] 緊急時のロールバック手順が文書化されている
- [ ] アカウントロックダウンスクリプトが準備されている
- [ ] IPブロッキング手順が確立されている
- [ ] 証拠保全手順が文書化されている

#### 復旧

- [ ] システム復旧手順が文書化されている
- [ ] バックアップが定期的に取得されている
- [ ] 復旧テストが定期的に実施されている（年2回以上）

#### 事後対応

- [ ] インシデントレポートテンプレートが準備されている
- [ ] Post-mortemプロセスが確立されている
- [ ] 教訓の共有プロセスが確立されている

---

### 8. テストとレビュー

#### セキュリティテスト

- [ ] SAST（静的解析）が実施されている
- [ ] DAST（動的解析）が実施されている
- [ ] 依存関係の脆弱性スキャンが実施されている（npm audit, Snyk）
- [ ] ペネトレーションテストが実施されている（年1回以上）

#### コードレビュー

- [ ] セキュリティに焦点を当てたコードレビューが実施されている
- [ ] Pull Requestにセキュリティチェックが含まれている
- [ ] CIパイプラインにセキュリティテストが組み込まれている

#### 監査

- [ ] 四半期ごとのセキュリティレビューが計画されている
- [ ] 第三者セキュリティ監査が年1回実施されている
- [ ] 監査結果が文書化され、改善計画が策定されている

---

### 9. ドキュメンテーション

#### セキュリティドキュメント

- [ ] セキュリティポリシーが文書化されている
- [ ] プライバシーポリシーが公開されている
- [ ] 利用規約が公開されている
- [ ] Cookie ポリシーが公開されている
- [ ] データ処理同意書が準備されている

#### 運用ドキュメント

- [ ] デプロイ手順が文書化されている
- [ ] ロールバック手順が文書化されている
- [ ] 緊急時対応手順が文書化されている
- [ ] セキュリティインシデント対応手順が文書化されている

#### トレーニング

- [ ] 開発チームへのセキュリティトレーニングが実施されている
- [ ] OWASP Top 10の理解度確認が行われている
- [ ] 定期的なセキュリティ意識向上プログラムが実施されている

---

### 10. 継続的改善

#### 定期レビュー

- [ ] 月次セキュリティレビュー会議が計画されている
- [ ] 四半期ごとのセキュリティ監査が計画されている
- [ ] 年次ペネトレーションテストが計画されている

#### 脆弱性管理

- [ ] 脆弱性スキャンが週次で自動実行されている
- [ ] CVE通知の購読が設定されている
- [ ] パッチ適用プロセスが確立されている
- [ ] 緊急パッチの適用手順が文書化されている

#### メトリクスとKPI

- [ ] セキュリティメトリクスが定義されている
- [ ] ダッシュボードでリアルタイム監視が可能
- [ ] 月次セキュリティレポートが作成されている
- [ ] セキュリティ目標が設定され、進捗が追跡されている

---

## 🎯 デプロイ承認

### すべての項目にチェックが入ったことを確認してください

**承認者**:
- [ ] セキュリティリード: ________________ 日付: __________
- [ ] CTO: ________________ 日付: __________
- [ ] コンプライアンス担当: ________________ 日付: __________

**備考**:
```
例外事項や追加コメントをここに記載してください。




```

---

## 📊 セキュリティスコア

各セクションの完了率を計算し、総合スコアを算出してください。

| セクション | 完了項目数 | 総項目数 | 完了率 |
|-----------|-----------|---------|--------|
| 1. 環境変数とシークレット管理 | ____ | 10 | ___% |
| 2. AWS Cognito設定 | ____ | 21 | ___% |
| 3. CloudFront/CDN セキュリティ | ____ | 15 | ___% |
| 4. アプリケーションコード | ____ | 14 | ___% |
| 5. インフラストラクチャ | ____ | 14 | ___% |
| 6. コンプライアンス | ____ | 18 | ___% |
| 7. インシデント対応 | ____ | 16 | ___% |
| 8. テストとレビュー | ____ | 9 | ___% |
| 9. ドキュメンテーション | ____ | 9 | ___% |
| 10. 継続的改善 | ____ | 12 | ___% |

**総合スコア**: _____% (目標: 95%以上)

---

## ⚠️ 本番デプロイ基準

以下の条件をすべて満たした場合のみ、本番環境へのデプロイを承認してください:

1. ✅ 総合スコアが95%以上
2. ✅ すべてのP0項目（Critical）が完了
3. ✅ セキュリティリード、CTO、コンプライアンス担当の承認取得
4. ✅ ペネトレーションテスト完了（重大な脆弱性なし）
5. ✅ インシデント対応計画のレビュー完了
6. ✅ GDPR/CCPA/個人情報保護法への準拠確認完了

**注意**: 95%未満のスコアでデプロイする場合は、例外承認が必要です。

---

## 🔄 次回レビュー予定

- **次回レビュー日**: __________________
- **担当者**: __________________
- **レビュー範囲**: 全項目 / 特定セクションのみ（該当に〇）

---

## 参考リソース

- [OWASP Top 10](https://owasp.org/www-project-top-ten/)
- [NIST Cybersecurity Framework](https://www.nist.gov/cyberframework)
- [AWS Security Best Practices](https://aws.amazon.com/architecture/security-identity-compliance/)
- [CIS Benchmarks](https://www.cisecurity.org/cis-benchmarks/)

---

最終更新日: 2025-11-11

# コスト見積もりデータ: 月次バッチ同期パターン

## 概要

このドキュメントは、既存のExcelファイル `/docs/CIS_AWS_Cost_Estimate_2Patterns.xlsx` に追加する「Pattern 3: Monthly Batch（月次バッチ同期）」のコスト見積もりデータです。

以下のデータをExcelの新しいシート「Pattern3_MonthlyBatch」にコピーしてください。

---

## 1. サマリー

### Pattern 3: Monthly Batch（月次バッチ同期）

| 項目 | 値 |
|------|-----|
| **月額コスト (USD)** | $45.79 |
| **月額コスト (JPY)** | ¥6,869 |
| **為替レート** | ¥150/USD |
| **想定ユーザー数** | 50人 |
| **月間検索数** | 10,000回 |
| **ファイル数** | 1,000,000ファイル |
| **データ量** | 500GB |
| **月次増分データ量** | 20GB |
| **同期頻度** | 月1回（深夜バッチ） |

---

## 2. 詳細コスト内訳

### 2.1 ネットワーク・VPN

| サービス | 詳細 | 数量 | 単価 (USD) | 月額 (USD) | 月額 (JPY) |
|---------|------|------|-----------|-----------|-----------|
| Site-to-Site VPN | 接続時間料金 | 4時間/月 | $0.05/時間 | $0.20 | ¥30 |
| VPN Data Transfer | アウトバウンド | 20GB/月 | $0.05/GB | $1.00 | ¥150 |
| **VPN 小計** | | | | **$1.20** | **¥180** |

### 2.2 データ転送・同期

| サービス | 詳細 | 数量 | 単価 (USD) | 月額 (USD) | 月額 (JPY) |
|---------|------|------|-----------|-----------|-----------|
| AWS DataSync | 増分データ転送 | 20GB/月 | $0.25/GB | $5.00 | ¥750 |
| **DataSync 小計** | | | | **$5.00** | **¥750** |

### 2.3 コンピューティング (Lambda)

| 関数名 | メモリ | 実行時間 | 実行回数/月 | GB-秒 | 単価 | 月額 (USD) | 月額 (JPY) |
|--------|--------|---------|------------|-------|------|-----------|-----------|
| TextExtractor | 2048MB | 5秒 | 5,000回 | 50,000 | $0.0000166667 | $0.83 | ¥125 |
| ImageFeatureExtractor | 2048MB | 3秒 | 2,000回 | 12,000 | $0.0000166667 | $0.20 | ¥30 |
| BulkIndexer | 1024MB | 600秒 | 1回 | 600 | $0.0000166667 | $0.01 | ¥2 |
| VPNManager | 512MB | 5秒 | 2回 | 5 | $0.0000166667 | $0.00 | ¥0 |
| FileScanner | 1024MB | 600秒 | 1回 | 600 | $0.0000166667 | $0.01 | ¥2 |
| SearchAPI | 512MB | 0.1秒 | 10,000回 | 500 | $0.0000166667 | $0.01 | ¥2 |
| **Lambda リクエスト** | | | 17,003回 | | $0.20/100万 | $0.00 | ¥0 |
| **Lambda 小計** | | | | | | **$1.06** | **¥159** |

**注**: Lambda料金はGraviton2 (ARM64) の20%割引適用後

### 2.4 データベース・検索

#### OpenSearch

| 項目 | 詳細 | 数量 | 単価 (USD) | 月額 (USD) | 月額 (JPY) |
|------|------|------|-----------|-----------|-----------|
| インスタンス | t3.small.search | 1ノード × 730時間 | $0.034/時間 | $24.82 | ¥3,723 |
| ストレージ | EBS gp3 | 50GB | $0.135/GB | $6.75 | ¥1,013 |
| **OpenSearch 小計** | | | | **$31.57** | **¥4,736** |

#### DynamoDB

| 項目 | 詳細 | 数量 | 単価 (USD) | 月額 (USD) | 月額 (JPY) |
|------|------|------|------|-----------|-----------|
| ストレージ | 標準ストレージ | 5GB | $0.25/GB | $1.25 | ¥188 |
| オンデマンド読み取り | RCU | 10,000リクエスト | $0.25/100万 | $0.00 | ¥0 |
| オンデマンド書き込み | WCU | 10,000リクエスト | $1.25/100万 | $0.01 | ¥2 |
| **DynamoDB 小計** | | | | **$1.26** | **¥189** |

### 2.5 ストレージ (S3)

| 項目 | 詳細 | 数量 | 単価 (USD) | 月額 (USD) | 月額 (JPY) |
|------|------|------|-----------|-----------|-----------|
| S3 Intelligent-Tiering | Frequent Access Tier | 60GB | $0.023/GB | $1.38 | ¥207 |
| S3 Intelligent-Tiering | Infrequent Access Tier | 40GB | $0.0125/GB | $0.50 | ¥75 |
| S3 PUT リクエスト | | 50,000回 | $0.005/1,000 | $0.25 | ¥38 |
| S3 GET リクエスト | | 50,000回 | $0.0004/1,000 | $0.02 | ¥3 |
| **S3 小計** | | | | **$2.15** | **¥323** |

### 2.6 オーケストレーション・通知

| サービス | 詳細 | 数量 | 単価 (USD) | 月額 (USD) | 月額 (JPY) |
|---------|------|------|-----------|-----------|-----------|
| Step Functions | State Transitions | 20ステップ × 1実行 | $0.025/1,000 | $0.00 | ¥0 |
| CloudWatch Logs | ログストレージ | 2GB | $0.50/GB | $1.00 | ¥150 |
| CloudWatch Metrics | カスタムメトリクス | 10メトリクス | $0.30/メトリクス | $3.00 | ¥450 |
| SNS | 通知メッセージ | 10メッセージ | $0.50/100万 | $0.00 | ¥0 |
| EventBridge | スケジュールルール | 1ルール | $1.00/ルール | $1.00 | ¥150 |
| **その他サービス 小計** | | | | **$5.00** | **¥750** |

---

## 3. 月額コスト合計

| カテゴリ | 月額 (USD) | 月額 (JPY) | 構成比 |
|---------|-----------|-----------|-------|
| ネットワーク・VPN | $1.20 | ¥180 | 2.6% |
| データ転送・同期 | $5.00 | ¥750 | 10.9% |
| コンピューティング (Lambda) | $1.06 | ¥159 | 2.3% |
| OpenSearch | $31.57 | ¥4,736 | 69.0% |
| DynamoDB | $1.26 | ¥189 | 2.8% |
| S3 | $2.15 | ¥323 | 4.7% |
| その他サービス | $5.00 | ¥750 | 10.9% |
| **合計** | **$47.24** | **¥7,086** | **100%** |

**注**: 実際の運用では、使用量の変動により月額 $45-50 の範囲で変動する可能性があります。

---

## 4. 初期投資

| 項目 | 金額 (USD) | 金額 (JPY) | 備考 |
|------|-----------|-----------|------|
| DataSync 初回同期 | $62.50 | ¥9,375 | 500GB × $0.125/GB（1回のみ） |
| テスト環境運用 | $47.24 | ¥7,086 | 1ヶ月分 |
| **初期投資合計** | **$109.74** | **¥16,461** | |

---

## 5. 年間・3年間コスト

### 年間コスト

| 項目 | 金額 (USD) | 金額 (JPY) |
|------|-----------|-----------|
| 月額コスト × 12ヶ月 | $566.88 | ¥85,032 |
| 初期投資（Year 1のみ） | $109.74 | ¥16,461 |
| **Year 1 合計** | **$676.62** | **¥101,493** |
| **Year 2 合計** | **$566.88** | **¥85,032** |
| **Year 3 合計** | **$566.88** | **¥85,032** |

### 3年間TCO (Total Cost of Ownership)

| 期間 | 金額 (USD) | 金額 (JPY) |
|------|-----------|-----------|
| Year 1 | $676.62 | ¥101,493 |
| Year 2 | $566.88 | ¥85,032 |
| Year 3 | $566.88 | ¥85,032 |
| **3年間合計** | **$1,810.38** | **¥271,557** |

---

## 6. パターン比較表

### 月額コスト比較

| パターン | 月額 (USD) | 月額 (JPY) | 削減率 (vs Pattern 2) |
|---------|-----------|-----------|---------------------|
| **Pattern 1: コスト最優先** | $90.40 | ¥13,560 | -48% |
| **Pattern 2: 高可用性+セキュリティ** | $1,105.50 | ¥165,825 | - |
| **Pattern 3: 月次バッチ** | $47.24 | ¥7,086 | **-96%** |

### 3年間TCO比較

| パターン | 3年間合計 (USD) | 3年間合計 (JPY) | 削減率 (vs Pattern 2) |
|---------|---------------|---------------|---------------------|
| **Pattern 1: コスト最優先** | $3,254.40 | ¥488,160 | -75% |
| **Pattern 2: 高可用性+セキュリティ** | $39,798.00 | ¥5,969,700 | - |
| **Pattern 3: 月次バッチ** | $1,810.38 | ¥271,557 | **-95%** |

### 主要機能比較

| 機能 | Pattern 1 | Pattern 2 | Pattern 3 |
|------|-----------|-----------|-----------|
| **全文検索** | ⚠️ 基本的 | ✅ 高度 | ✅ 高度 |
| **画像類似検索** | ❌ なし | ✅ あり | ✅ あり (k-NN) |
| **データ同期** | 手動 | リアルタイム | 月次バッチ |
| **高可用性** | ❌ Single-AZ | ✅ Multi-AZ | ⚠️ Single-AZ |
| **セキュリティ** | ⚠️ 基本的 | ✅ 高度 | ✅ 中程度 |
| **スケーラビリティ** | ⚠️ 制限あり | ✅ 高 | ✅ 高 |
| **運用負荷** | 高 | 低 | 低 |

---

## 7. コスト削減のポイント

### 月次バッチパターンの主な削減要因

| 削減項目 | 削減額/月 (USD) | 削減率 | 説明 |
|---------|---------------|--------|------|
| **VPN常時接続 → 月1回接続** | $34.80 | 97% | 730時間 → 4時間 |
| **DataSync リアルタイム → 増分** | $15.00 | 75% | 100GB → 20GB |
| **Lambda 常時実行 → 月1回** | $13.94 | 93% | バッチ化による効率化 |
| **Multi-AZ → Single-AZ** | $500.00 | - | 可用性要件の見直し |
| **Reserved Instances未適用** | $0 | - | 今後の最適化余地 |

### さらなるコスト削減の可能性

| 最適化施策 | 追加削減額/月 (USD) | 実施時期 |
|-----------|-------------------|---------|
| OpenSearch Reserved Instances (1年契約) | $10.00 | Month 3-6 |
| Compute Savings Plans | $5.00 | Month 3-6 |
| S3 Glacier Deep Archive (2年以上前データ) | $3.40 | Month 6-12 |
| Lambda Graviton2最適化 | $0.50 | 実施済み |
| **合計削減可能額** | **$18.90** | |

**最適化後の月額コスト**: $47.24 - $18.90 = **$28.34/月** (¥4,251/月)

---

## 8. スケーリングシナリオ

### ユーザー数・検索数の増加

| シナリオ | ユーザー数 | 月間検索数 | Lambda | OpenSearch | 月額合計 (USD) |
|---------|-----------|-----------|--------|-----------|--------------|
| **現在** | 50人 | 10,000回 | $1.06 | $31.57 | **$47.24** |
| 小規模拡大 | 100人 | 20,000回 | $1.11 | $31.57 | **$48.29** |
| 中規模拡大 | 200人 | 40,000回 | $1.21 | $56.88 | **$73.70** |
| 大規模拡大 | 500人 | 100,000回 | $2.56 | $106.00 | **$123.17** |

**注**: 200人以上でt3.medium.searchへのスケールアップが必要

### ファイル数・データ量の増加

| シナリオ | ファイル数 | データ量 | 月次増分 | OpenSearch Storage | S3 | 月額合計 (USD) |
|---------|-----------|---------|---------|-------------------|-----|--------------|
| **現在** | 100万 | 500GB | 20GB | $6.75 | $2.15 | **$47.24** |
| 2倍 | 200万 | 1TB | 40GB | $13.50 | $4.60 | **$62.99** |
| 5倍 | 500万 | 2.5TB | 100GB | $33.75 | $11.50 | **$115.34** |
| 10倍 | 1000万 | 5TB | 200GB | $67.50 | $23.00 | **$196.79** |

**注**: 500万ファイル以上でOpenSearchのクラスタ化（2ノード）が推奨

---

## 9. Excel転記用データ

### Sheet: Pattern3_Summary

```
Pattern 3: Monthly Batch Synchronization
月額コスト (USD),47.24
月額コスト (JPY),7086
為替レート,150
想定ユーザー数,50
月間検索数,10000
ファイル数,1000000
データ量 (GB),500
月次増分 (GB),20
同期頻度,月1回
```

### Sheet: Pattern3_Details

```
カテゴリ,サービス,詳細,数量,単価 (USD),月額 (USD),月額 (JPY)
ネットワーク,Site-to-Site VPN,接続時間料金,4時間/月,0.05,0.20,30
ネットワーク,VPN Data Transfer,アウトバウンド,20GB/月,0.05,1.00,150
データ転送,AWS DataSync,増分データ転送,20GB/月,0.25,5.00,750
コンピューティング,Lambda TextExtractor,2048MB × 5秒 × 5000回,50000 GB-秒,0.0000166667,0.83,125
コンピューティング,Lambda ImageFeatureExtractor,2048MB × 3秒 × 2000回,12000 GB-秒,0.0000166667,0.20,30
コンピューティング,Lambda BulkIndexer,1024MB × 600秒 × 1回,600 GB-秒,0.0000166667,0.01,2
コンピューティング,Lambda SearchAPI,512MB × 0.1秒 × 10000回,500 GB-秒,0.0000166667,0.01,2
検索エンジン,OpenSearch t3.small.search,1ノード × 730時間,730時間,0.034,24.82,3723
検索エンジン,OpenSearch Storage,EBS gp3,50GB,0.135,6.75,1013
データベース,DynamoDB Storage,標準ストレージ,5GB,0.25,1.25,188
データベース,DynamoDB Read,オンデマンド RCU,10000リクエスト,0.00000025,0.00,0
データベース,DynamoDB Write,オンデマンド WCU,10000リクエスト,0.00000125,0.01,2
ストレージ,S3 Intelligent-Tiering,Frequent Access,60GB,0.023,1.38,207
ストレージ,S3 Intelligent-Tiering,Infrequent Access,40GB,0.0125,0.50,75
ストレージ,S3 PUT Requests,,50000回,0.000005,0.25,38
ストレージ,S3 GET Requests,,50000回,0.0004/1000,0.02,3
その他,Step Functions,State Transitions,20ステップ,0.000025,0.00,0
その他,CloudWatch Logs,ログストレージ,2GB,0.50,1.00,150
その他,CloudWatch Metrics,カスタムメトリクス,10メトリクス,0.30,3.00,450
その他,SNS,通知メッセージ,10メッセージ,0.0000005,0.00,0
その他,EventBridge,スケジュールルール,1ルール,1.00,1.00,150
```

---

## 10. 注意事項

### コスト変動要因

1. **為替レート変動**: JPY表示は¥150/USDで計算。実際の請求額は変動します
2. **使用量変動**: 月次増分データ量、検索回数により±20%程度変動する可能性
3. **AWS料金改定**: AWS公式の料金改定により変更される場合があります
4. **オプション機能**: 以下は含まれていません
   - バックアップストレージ
   - WAF (Web Application Firewall)
   - GuardDuty (脅威検出)
   - CloudTrail (詳細監査ログ)

### 推奨事項

1. **月次モニタリング**: AWS Cost Explorer でコスト推移を監視
2. **Budget Alert**: $60/月を超えたらアラート
3. **Reserved Instances**: 3ヶ月安定稼働後に1年契約を検討
4. **定期レビュー**: 四半期ごとにコスト最適化を見直し

---

以上のデータを `/docs/CIS_AWS_Cost_Estimate_2Patterns.xlsx` の新しいシート「Pattern3_MonthlyBatch」に転記してください。
